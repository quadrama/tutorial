\documentclass[]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={DramaAnalysis},
            pdfauthor={Nils Reiter},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{apalike}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\providecommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{DramaAnalysis}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Nils Reiter}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{2019-06-13}


\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}
\addcontentsline{toc}{chapter}{Preface}

\emph{This book is in alpha stadium and not ready. It pertains to the (currently unreleased) version 3.0 of the DramaAnalysis package. Use at your own risk.}

\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

\begin{figure}
\includegraphics[width=0.9\linewidth]{DramaAnalysis_files/figure-latex/unnamed-chunk-1-1} \caption{Some caption.}\label{fig:unnamed-chunk-1}
\end{figure}

\hypertarget{classes}{%
\section{Classes}\label{classes}}

\hypertarget{data}{%
\chapter{Data}\label{data}}

Before analysing any data, it needs to be imported, and converted into the proper structure. In QuaDramA, we process dramatic texts in multiple stages, described below.

\hypertarget{origin-tei-xml}{%
\section{Origin: TEI-XML}\label{origin-tei-xml}}

The base format that we use (and in which we put all our annotations) is an XML format known as \href{https://tei-c.org}{TEI}. This format is used by most researchers doing quantitatitve drama analysis. An excellent source for dramas in the proper format is \href{https://github.com/dracor-org/}{DraCor}, maintained by \href{https://www.hse.ru/en/org/persons/182492735}{Frank Fischer}.

While we are using GerDraCor as a basis, we have added linguistic annotations to a number of plays, and integrated more plays (e.g., translations) into the corpus. This corpus can be found \href{https://github.com/quadrama/Corpus}{here}.

\hypertarget{preprocessed-data}{%
\section{Preprocessed data}\label{preprocessed-data}}

As a first step, we process all dramatic texts using our \href{https://github.com/quadrama/DramaNLP}{DramaNLP} pipeline. The result of this processing is a set of CSV files for each play that contains the information in the play in a format suitable for analysis with R. \href{https://github.com/quadrama/data_test}{This repository} contains two plays in the format.

\begin{longtable}[]{@{}ll@{}}
\caption{Different CSV files used in the analysis. \emph{ID} is a placeholder for a unique identifier for the play}\tabularnewline
\toprule
\begin{minipage}[b]{0.26\columnwidth}\raggedright
File\strut
\end{minipage} & \begin{minipage}[b]{0.68\columnwidth}\raggedright
Description\strut
\end{minipage}\tabularnewline
\midrule
\endfirsthead
\toprule
\begin{minipage}[b]{0.26\columnwidth}\raggedright
File\strut
\end{minipage} & \begin{minipage}[b]{0.68\columnwidth}\raggedright
Description\strut
\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.26\columnwidth}\raggedright
\emph{ID}.Metadata.csv\strut
\end{minipage} & \begin{minipage}[t]{0.68\columnwidth}\raggedright
Meta data for the play (author, title, language, \ldots{})\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.26\columnwidth}\raggedright
\emph{ID}.Characters.csv\strut
\end{minipage} & \begin{minipage}[t]{0.68\columnwidth}\raggedright
Characters of the play, with some character specific information\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.26\columnwidth}\raggedright
\emph{ID}.Entities.csv\strut
\end{minipage} & \begin{minipage}[t]{0.68\columnwidth}\raggedright
All discourse entities (including characters, but also all other coreference chains)\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.26\columnwidth}\raggedright
\emph{ID}.Mentions.csv\strut
\end{minipage} & \begin{minipage}[t]{0.68\columnwidth}\raggedright
Mentions associated with characters\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.26\columnwidth}\raggedright
\emph{ID}.StageDirections.csv\strut
\end{minipage} & \begin{minipage}[t]{0.68\columnwidth}\raggedright
The stage directions of the play\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.26\columnwidth}\raggedright
\emph{ID}.UtterancesWithTokens.csv\strut
\end{minipage} & \begin{minipage}[t]{0.68\columnwidth}\raggedright
All character utterances of the play\strut
\end{minipage}\tabularnewline
\begin{minipage}[t]{0.26\columnwidth}\raggedright
\emph{ID}.Segments.csv\strut
\end{minipage} & \begin{minipage}[t]{0.68\columnwidth}\raggedright
Information about acts and scenes\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

Next to the above mentioned \texttt{test}-corpus, we are providing others as well. They are all stored in git repositories in the \href{https://github.com/quadrama}{quadrama organization on GitHub}. Repositories that start with \texttt{data\_} are corpora.

The part after the underscore (\texttt{test} in the above example) is considered to be the corpus prefix. Within a corpus, a play is identified by a unique id. Thus, \texttt{test:rksp.0} is a full identified containing the corpus prefix and play id.

\hypertarget{sample-data}{%
\subsection{Sample data}\label{sample-data}}

For demo and test purposes, the \texttt{DramaAnalysis} r package contains the two plays of the \texttt{test} corpus. For technical reasons, the plays that are included in the package do not contain umlauts (äöüß etc.), but are restricted to ASCII characters. In these versions, all non-ASCII characters have been replaced by ASCII characters.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Load Emilia Galotti}
\KeywordTok{data}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}

\CommentTok{# Load Miß Sara Sampson}
\KeywordTok{data}\NormalTok{(rjmw}\FloatTok{.0}\NormalTok{)}

\NormalTok{text <-}\StringTok{ }\KeywordTok{combine}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, rjmw}\FloatTok{.0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{installing-corpora}{%
\section{Installing corpora}\label{installing-corpora}}

Installing a corpus that is available on \href{http://github.com/quadrama}{github.com/quadrama} is straightforward and can be done by entering the command \texttt{installData()} into the R console.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# installation of the test corpus}
\KeywordTok{installData}\NormalTok{(}\StringTok{"test"}\NormalTok{)}

\CommentTok{# installation of the quadrama corpus}
\KeywordTok{installData}\NormalTok{(}\StringTok{"qd"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Corpora do not necessarily have to be provided by us, however. If a compatible set of CSV files is available from another source, the function \texttt{installData()} allows finer control to install data from anywhere, as long as it's a git repository and can be cloned. See \texttt{?installData} for details on the options.

\hypertarget{collection-data}{%
\section{Collection data}\label{collection-data}}

In addition to the above introduced corpora, we also support smaller groups of plays called collections. A collection is just a set of texts, and can include texts from multiple corpora. Typically, these sets have names, such as ``comedies'', but it does not technically matter why texts are in a collection. Technically, these collections are just vectors of ids.

Pre-defined collections can be downloaded with the function \texttt{installCollectionData()}. This function clones a git repository (\href{https://github.com/quadrama/metadata}{this one}), which contains a number of plain text files that in turn contain drama ids. As before, users can feed in other sources for the collection data, enter \texttt{?installCollectionData} in the R console to get more information about options and parameters.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{installCollectionData}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Once collection (i.e., a vector with ids) has been defined, it can be passed as an argument to the function \texttt{loadDrama()}. The returning \texttt{QDDrama} object contains all loadable plays. Many functions work similarly for single texts or text collections, but some will not. The descriptions below contain information about this.

\hypertarget{defining-collections}{%
\subsection{Defining collections}\label{defining-collections}}

Before processing, it's necessary to define a collection of texts, by assembling their ids in a list. These are considered to be sets of plays without internal structure (e.g., no play is marked as prototypical).

\hypertarget{basics}{%
\chapter{Basics}\label{basics}}

This is not really an R tutorial. If you're looking for a full-fledged R tutorial, we recommend \citep{Arnold:2015aa}, because it is very practical, and also deals with text analysis. However, this chapter introduces some concepts related to R.

\hypertarget{r-basics}{%
\section{R Basics}\label{r-basics}}

\hypertarget{variable-assignment}{%
\subsection{Variable assignment}\label{variable-assignment}}

Assigning variables is one of the things you do most frequently in most programming languages. In R, this is done with the arrow operator: \texttt{a\ \textless{}-\ 5}. This creates a new variable \texttt{a} that has the value 5. Conceptually, variables are aliases for values. The same value can be assigned to multiple names, but one variable only can point to one value.

\hypertarget{function-calls}{%
\subsection{Function calls}\label{function-calls}}

The R package for drama analysis defines a number of functions. Functions are mini programs that can be executed anytime by a user. Function calls (i.e., the execution of a function) can be recognized by round parentheses: \texttt{sessionInfo()} is a function call. If you enter this in the R console and press enter, the function gets executed and its return value is printed on the console. The function \href{https://www.rdocumentation.org/packages/utils/versions/3.6.0/topics/sessionInfo}{\texttt{sessionInfo()}} can be used to get information about your R session and installation. The function does not take any arguments, which is why the round parentheses are empty. The function \texttt{sum}, on the other hand, takes arguments: The values it should add. Thus, calling \texttt{sum(1,1)} prints 2 on the console.

\hypertarget{magrittr}{%
\section{\texorpdfstring{magrittr Pipes / \texttt{\%\textgreater{}\%}}{magrittr Pipes / \%\textgreater{}\%}}\label{magrittr}}

In the tutorial, we make heavy use of \texttt{magrittr}-pipes. These are provided by the R package \href{https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html}{\texttt{magrittr}}. The core idea behind pipes is to use the output of one function directly as input for the next function -- to create a pipeline of functions (if you're familiar with the unix command line you probably have used this before).

The pipeline is represented by \texttt{\%\textgreater{}\%}. The semantics of \texttt{\%\textgreater{}\%} is to use the output of whatever comes before as \emph{first argument} for whatever comes after. Thus, if we write \texttt{runif(5)\ \%\textgreater{}\%\ barplot}, the result of \texttt{runif(5)} (which is a vector with five random numbers) is used as the first argument for the function \texttt{barplot()}. This is eqivalent to:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{r <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\KeywordTok{barplot}\NormalTok{(r)}
\end{Highlighting}
\end{Shaded}

The nice thing about magrittr is that you can create pipes that are much longer:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d <-}\StringTok{ }\KeywordTok{loadDrama}\NormalTok{(}\StringTok{"test:rksp.0"}\NormalTok{)}

\NormalTok{d }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{dictionaryStatistics}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(d) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(d) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{barplot}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

Again, this is equivalent to a version with variables:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d <-}\StringTok{ }\KeywordTok{loadDrama}\NormalTok{(}\StringTok{"test:rksp.0"}\NormalTok{)}

\NormalTok{ds <-}\StringTok{ }\KeywordTok{dictionaryStatistics}\NormalTok{(d)}
\NormalTok{dsf <-}\StringTok{ }\KeywordTok{filter}\NormalTok{(ds, d)}
\NormalTok{dsff <-}\StringTok{ }\KeywordTok{format}\NormalTok{(dsf, d)}
\KeywordTok{barplot}\NormalTok{(dsff)}
\end{Highlighting}
\end{Shaded}

Pipes are much faster to write and more transparent, that's why they are used in this tutorial.

\hypertarget{who-how-much}{%
\chapter{Who's talking how much?}\label{who-how-much}}

We're assuming here that we have loaded some texts using \texttt{loadDrama()}, and that this text is stored as a \texttt{QDDrama}-object in the variable \texttt{text}. For demo purposes, we will use the two plays that are included in the R-package, Lessing's \emph{Emilia Galotti} and \emph{Miss Sara Sampson}. Both have been preprocessed by the \href{https://github.com/quadrama/DramaNLP}{DramaNLP} pipeline.

\begin{figure}
\includegraphics[width=0.9\linewidth]{DramaAnalysis_files/figure-latex/unnamed-chunk-8-1} \caption{Relevant classes and functions in this chapter}\label{fig:unnamed-chunk-8}
\end{figure}

First, we calculate summary statistics over all characters.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{characterStatistics}\NormalTok{(text)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    corpus  drama        character tokens types utterances
## 1    test rjmw.0      sir_william   2056   698         23
## 2    test rjmw.0         waitwell   1826   568         41
## 3    test rjmw.0         der_wirt    324   177          7
## 4    test rjmw.0        mellefont   7981  1722        201
## 5    test rjmw.0           norton   1001   407         46
## 6    test rjmw.0            betty    482   223         20
## 7    test rjmw.0             sara   9121  1908        166
## 8    test rjmw.0          marwood   7225  1757        155
## 9    test rjmw.0           hannah    258   155         16
## 10   test rjmw.0     der_bediente     44    34          2
## 11   test rjmw.0         arabella    398   162         13
## 12   test rksp.0        der_prinz   5303  1257        157
## 13   test rksp.0 der_kammerdiener     42    34          6
## 14   test rksp.0            conti    764   325         24
## 15   test rksp.0        marinelli   5567  1324        221
## 16   test rksp.0     camillo_rota    106    62          6
## 17   test rksp.0  claudia_galotti   2098   657         73
## 18   test rksp.0            pirro    343   196         25
## 19   test rksp.0          odoardo   3248   891        108
## 20   test rksp.0           angelo    635   300         28
## 21   test rksp.0           emilia   2275   630         64
## 22   test rksp.0          appiani   1112   426         48
## 23   test rksp.0         battista    195   112         11
## 24   test rksp.0           orsina   2832   743         64
##    utteranceLengthMean utteranceLengthSd firstBegin lastEnd
## 1             89.39130        108.948169        597  170838
## 2             44.53659         59.768762        670  158683
## 3             46.28571         45.492543       3571    5695
## 4             39.70647         50.034972       5848  170188
## 5             21.76087         23.601492       6328  170456
## 6             24.10000         36.404019       9014  156987
## 7             54.94578         77.785973      11766  167457
## 8             46.61290         62.383230      28320  141005
## 9             16.12500         15.654073      28392   58523
## 10            22.00000         12.727922      31532   31790
## 11            30.61538         31.967532      43987   52559
## 12            33.77707         40.807176        426  136067
## 13             7.00000          5.215362       1149   24954
## 14            31.83333         40.141778       2654   12212
## 15            25.19005         29.844599      13147  134486
## 16            17.66667         19.179851      25577   26914
## 17            28.73973         29.131897      27006  112526
## 18            13.72000         10.663489      27113   50425
## 19            30.07407         40.399571      27385  135555
## 20            22.67857         19.573326      28777   64877
## 21            35.54688         48.159105      36769  134940
## 22            23.16667         25.525401      44452   56735
## 23            17.72727         32.948720      67465   86481
## 24            44.25000         50.977119      88094  112182
\end{verbatim}

This already gives us a lot of information about the characters. In particular, the function \texttt{characterStatistics()} returns a table (of the types \texttt{QDCharacterStatistics}, \texttt{QDHasCharacter} and \texttt{data.frame}) with information about:

\begin{itemize}
\tightlist
\item
  the number of tokens a character speaks (\texttt{tokens}),
\item
  the number of different tokens a character speaks (\texttt{types}),
\item
  the number of utterances (\texttt{utterances}),
\item
  the average length of the utterances (\texttt{utteranceLengthMean}),
\item
  their standard deviation (\texttt{utteranceLengthSd}),
\item
  the character position of the start of the first utterance (\texttt{firstBegin}), and
\item
  the character position of the end of the last utterance (\texttt{lastEnd}).
\end{itemize}

The function \texttt{characterStatistics()} provides a number of options to control its exact behaviour. Entering \texttt{?characterStatistics} in the R console opens the documentation for the function with a description of all the options. We'll describe some frequently used options here as well:

\begin{itemize}
\item
  Punctuation: By default, all punctuation marks are counted as tokens. This behaviour can be changed by setting \texttt{filterPunctuation=TRUE}.
\item
  Normalization: The values in the table above are all absolute values. When comparing to other texts, one is often interested in normalized values. If the option \texttt{normalize} is set to \texttt{TRUE}, all values will be normalised (if applicable).
\item
  Segmentation: By default, the function extracts values for the entire play. With the option \texttt{segment}, it is possible to extract statistics by act or scene, as shown in the example below. Except for the additional column \texttt{Act}, the columns in the table are the same as before.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{characterStatistics}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }
                    \DataTypeTok{segment=}\StringTok{"Act"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    corpus  drama Act        character tokens types utterances
## 1    test rksp.0   I        der_prinz   2740   795         71
## 2    test rksp.0   I der_kammerdiener     42    34          6
## 3    test rksp.0   I            conti    764   325         24
## 4    test rksp.0   I        marinelli   1038   412         31
## 5    test rksp.0   I     camillo_rota    106    62          6
## 6    test rksp.0  II  claudia_galotti   1252   477         50
## 7    test rksp.0  II            pirro    343   196         25
## 8    test rksp.0  II          odoardo    611   295         17
## 9    test rksp.0  II           angelo    385   214         19
## 10   test rksp.0  II           emilia   1166   417         28
## 11   test rksp.0  II          appiani   1112   426         48
## 12   test rksp.0  II        marinelli    527   255         28
## 13   test rksp.0 III        marinelli   1814   605         56
## 14   test rksp.0 III        der_prinz    945   398         29
## 15   test rksp.0 III           angelo    250   147          9
## 16   test rksp.0 III         battista    187   106          9
## 17   test rksp.0 III           emilia    413   175         16
## 18   test rksp.0 III  claudia_galotti    614   241         16
## 19   test rksp.0  IV        der_prinz    803   319         30
## 20   test rksp.0  IV        marinelli   1358   495         72
## 21   test rksp.0  IV         battista      8     7          2
## 22   test rksp.0  IV           orsina   2832   743         64
## 23   test rksp.0  IV          odoardo    706   275         30
## 24   test rksp.0  IV  claudia_galotti    232   125          7
## 25   test rksp.0   V        marinelli    830   363         34
## 26   test rksp.0   V        der_prinz    815   321         27
## 27   test rksp.0   V          odoardo   1931   620         61
## 28   test rksp.0   V           emilia    696   251         20
##    utteranceLengthMean utteranceLengthSd firstBegin lastEnd
## 1             38.59155         39.891130        426   26559
## 2              7.00000          5.215362       1149   24954
## 3             31.83333         40.141778       2654   12212
## 4             33.48387         34.234360      13147   23619
## 5             17.66667         19.179851      25577   26914
## 6             25.04000         28.927750      27006   56666
## 7             13.72000         10.663489      27113   50425
## 8             35.94118         41.800823      27385   36244
## 9             20.26316         19.674694      28777   32436
## 10            41.64286         63.826277      36769   48503
## 11            23.16667         25.525401      44452   56735
## 12            18.82143         17.346263      50431   55936
## 13            32.39286         35.245982      56826   79337
## 14            32.58621         48.327393      56914   72918
## 15            27.77778         19.466495      63132   64877
## 16            20.77778         36.033935      67465   75603
## 17            25.81250         27.352559      67517   79537
## 18            38.37500         28.765431      74777   79747
## 19            26.76667         38.699268      79838   95409
## 20            18.86111         20.750229      79972  103998
## 21             4.00000          2.828427      86363   86481
## 22            44.25000         50.977119      88094  112182
## 23            23.53333         18.528140     101533  112733
## 24            33.14286         29.952343     110037  112526
## 25            24.41176         36.802600     112824  134486
## 26            30.18519         37.235257     113752  136067
## 27            31.65574         47.382094     114998  135555
## 28            34.80000         34.284568     128910  134940
\end{verbatim}

Of course, the values in the above table can be directly plotted:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{charStats <-}\StringTok{ }\KeywordTok{characterStatistics}\NormalTok{(text, }\DataTypeTok{normalize=}\OtherTok{FALSE}\NormalTok{)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{9}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)) }\CommentTok{# increase plot margins, so that the labels can be plotted}

\KeywordTok{barplot}\NormalTok{(charStats}\OperatorTok{$}\NormalTok{tokens,  }\CommentTok{# these are the values to be plotted}
        \DataTypeTok{names.arg =}\NormalTok{ charStats}\OperatorTok{$}\NormalTok{character, }\CommentTok{# the labels on the x-axis}
        \DataTypeTok{las=}\DecValTok{2} \CommentTok{# rotate the labels on both axes}
\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-11-1.pdf}

\hypertarget{format}{%
\section{Character names instead of identifiers}\label{format}}

By default, all our functions identify characters using technical ids, which may or may not be human-readable. Even if they are, it's usually a good idea to replace them with nice to read labels before publication. We therefore provide the function \texttt{format()}, which can be applied to any table that contains a column with character ids (i.e., any object of type \texttt{QDHasCharacter}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{charStats <-}\StringTok{ }\KeywordTok{characterStatistics}\NormalTok{(text, }\DataTypeTok{normalize=}\OtherTok{FALSE}\NormalTok{)}

\NormalTok{charStats <-}\StringTok{ }\KeywordTok{format}\NormalTok{(charStats, text) }\CommentTok{# Replace ids with names}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{9}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)) }\CommentTok{# increase plot margins, so that the labels can be plotted}

\KeywordTok{barplot}\NormalTok{(charStats}\OperatorTok{$}\NormalTok{tokens,  }\CommentTok{# these are the values to be plotted}
        \DataTypeTok{names.arg =}\NormalTok{ charStats}\OperatorTok{$}\NormalTok{character, }\CommentTok{# the labels on the x-axis}
        \DataTypeTok{las=}\DecValTok{2} \CommentTok{# rotate the labels on both axes}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-12-1.pdf}

As can be seen above \texttt{format()} requires two arguments: The table in which we want to replace ids by characters, and the original drama object (that we got from calling the function \texttt{loadDrama()}).

\hypertarget{stacked-bar-plot}{%
\section{Stacked bar plot}\label{stacked-bar-plot}}

The plot shown above is quite wide, and some aspects (like the ranking in terms of spoken tokens), is hard to see. We often use another way of visualizing this, which can be used if you supply the \texttt{QDCharacterStatistics} directly into the \texttt{barplot()} function. In combination with the \texttt{magrittr} pipes (see \ref{magrittr}), we can call it like this (enter \texttt{?barplot.QDCharacterStatistics} for details on the special barplot function):

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{characterStatistics}\NormalTok{(text, }\DataTypeTok{normalize=}\OtherTok{FALSE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(text) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{barplot}\NormalTok{(}\DataTypeTok{names.arg=}\KeywordTok{dramaNames}\NormalTok{(text, }\StringTok{"%T"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-13-1.pdf}

By default, the \texttt{barplot.QDCharacterStatistics()} function visualises the number of tokens spoken by the characters (and ranks the characters accordingly). This can be changed by supplying the option \texttt{column}, and specifying another value.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{characterStatistics}\NormalTok{(text, }\DataTypeTok{normalize=}\OtherTok{FALSE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(text) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{barplot}\NormalTok{(}\DataTypeTok{names.arg=}\KeywordTok{dramaNames}\NormalTok{(text, }\StringTok{"%T"}\NormalTok{), }
          \DataTypeTok{column =} \StringTok{"utteranceLengthMean"}\NormalTok{) }\CommentTok{# show mean utterance length}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-14-1.pdf}

This picture looks quite different! Other interesting columns to experiment with are \texttt{types} and \texttt{utteranceLengthSd}.

Another function that we used above is called \texttt{dramaNames()}. It can be used to extract

\hypertarget{collection-analysis}{%
\section{Collection analysis}\label{collection-analysis}}

As we have already seen above, the \texttt{characterStatistics()} function works well with multiple texts. This means, we can also use it to analyze all \emph{Sturm und Drang} plays at once:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# this list can also be loaded using loadSet()}
\NormalTok{sturm_und_drang.ids <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"qd:11f81.0"}\NormalTok{, }\StringTok{"qd:11g1d.0"}\NormalTok{, }\StringTok{"qd:11g9w.0"}\NormalTok{, }
                         \StringTok{"qd:11hdv.0"}\NormalTok{, }\StringTok{"qd:nds0.0"}\NormalTok{, }\StringTok{"qd:r12k.0"}\NormalTok{, }
                         \StringTok{"qd:r12v.0"}\NormalTok{, }\StringTok{"qd:r134.0"}\NormalTok{,  }\StringTok{"qd:r13g.0"}\NormalTok{, }
                         \StringTok{"qd:rfxf.0"}\NormalTok{,  }\StringTok{"qd:rhtz.0"}\NormalTok{, }\StringTok{"qd:rhzq.0"}\NormalTok{, }
                         \StringTok{"qd:rj22.0"}\NormalTok{, }\StringTok{"qd:tx4z.0"}\NormalTok{, }\StringTok{"qd:tz39.0"}\NormalTok{, }
                         \StringTok{"qd:tzgk.0"}\NormalTok{, }\StringTok{"qd:v0fv.0"}\NormalTok{, }\StringTok{"qd:wznj.0"}\NormalTok{, }
                         \StringTok{"qd:tx4z.0"}\NormalTok{, }\StringTok{"qd:rfxf.0"}\NormalTok{)}

\NormalTok{sturm_und_drang.plays <-}\StringTok{ }\KeywordTok{loadDrama}\NormalTok{(sturm_und_drang.ids)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{30}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{characterStatistics}\NormalTok{(sturm_und_drang.plays, }\DataTypeTok{normalize=}\OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(sturm_und_drang.plays) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{barplot}\NormalTok{(}\DataTypeTok{las=}\DecValTok{2}\NormalTok{, }\DataTypeTok{names.arg =} \KeywordTok{dramaNames}\NormalTok{(sturm_und_drang.plays, }
                                        \DataTypeTok{formatString =} \StringTok{"%A: %T"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-15-1.pdf}

While readability can certainly be improved upon, we can directly see that the relative active presence of the characters is distributed very differently in different plays. The most ``talkative'' character in Klinger's \emph{Zwillinge}, for instance, speaks almost one half of the words in the play, while Wenzelslaus in Lenz' \emph{Hofmeister} speaks much less, even in relative terms.

\hypertarget{who-how-often}{%
\chapter{Who's talking how often?}\label{who-how-often}}

So far, we have counted words for characters. Now we will turn to utterances, and their properties.

First, we will use the function \texttt{utteranceStatistics()} to extract quantitative information about utterances:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{utteranceStatistics}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    corpus  drama        character utteranceBegin utteranceLength
## 1    test rksp.0        der_prinz            426    3.874388e-03
## 2    test rksp.0 der_kammerdiener           1149    8.156607e-05
## 3    test rksp.0        der_prinz           1178    2.895595e-03
## 4    test rksp.0 der_kammerdiener           1526    6.525285e-04
## 5    test rksp.0        der_prinz           1655    2.854812e-04
## 6    test rksp.0 der_kammerdiener           1697    1.631321e-04
## 7    test rksp.0        der_prinz           1739    1.019576e-03
## 8    test rksp.0 der_kammerdiener           1857    3.262643e-04
## 9    test rksp.0        der_prinz           1919    2.528548e-03
## 10   test rksp.0 der_kammerdiener           2299    3.670473e-04
\end{verbatim}

This creates a table that is very long, which is why we only show the first 10 rows here. The table contains one row for each utterance, and information about the speaker of the utterance, its length (measured in tokens) and its starting position (character position). We can now inspect the variance in utterance length:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ustat <-}\StringTok{ }\KeywordTok{utteranceStatistics}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)   }\CommentTok{# use names instead of character ids (see above)}
  
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{9}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)) }\CommentTok{# increase margin}

\KeywordTok{boxplot}\NormalTok{(utteranceLength }\OperatorTok{~}\StringTok{ }\NormalTok{character, }\CommentTok{# what do we want to correlate }
        \DataTypeTok{data=}\NormalTok{ustat,   }\CommentTok{# the data set to use}
        \DataTypeTok{main =} \KeywordTok{dramaNames}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{), }\CommentTok{# the main title of the plot}
        \DataTypeTok{las =} \DecValTok{2} \CommentTok{# rotate axis labels}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-18-1.pdf}

This uses the regular \texttt{boxplot()} function, enter \texttt{?boxplot} for documentation. \texttt{utteranceLength\ \textasciitilde{}\ character} is called a formula in R and (in this case) expresses that we want to look at the column \texttt{utteranceLength}, grouped by the column \texttt{character}. The boxplot is a useful way to grasp the dispersion of a set of values (in this case: the lengths of all utterances by a character).

\hypertarget{when-are-characters-talking}{%
\section{When are characters talking?}\label{when-are-characters-talking}}

While the above displays the \emph{length} of utterances, we can also display the position of utterances (remember the column \texttt{utteranceBegin}?). The following snippet visualizes when characters are talking, this time for Lessings Miss Sara Sampson:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}

\KeywordTok{utteranceStatistics}\NormalTok{(rjmw}\FloatTok{.0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(rjmw}\FloatTok{.0}\NormalTok{) }\OperatorTok{%>%}\StringTok{    }\CommentTok{# character names instead of ids}
\StringTok{  }\KeywordTok{plot}\NormalTok{(}\DataTypeTok{main=}\KeywordTok{dramaNames}\NormalTok{(rjmw}\FloatTok{.0}\NormalTok{))                }\CommentTok{# calling plot.QDUtteranceStatistics()}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-19-1.pdf}

Each dot in this plot represents one utterance, the x-axis is measured in character positions. This is not really intuitive, but the flow from left to right represents the flow of the text. More technically, we again apply the function \texttt{format()} to display character names instead of character ids. This is the same function as above, just applied to a different table. It can be applied to any table of the type \texttt{QDHasCharacter}. Secondly, the call to the function \texttt{plot()} gets rerouted to the function \texttt{plot.QDUtteranceStatistics()}, because the object we supply as argument is of the type \texttt{QDUtteranceStatistics}. Information about this function can be retrieved by entering \texttt{?plot.QDUtteranceStatistics}.

\hypertarget{adding-act-boundaries}{%
\section{Adding act boundaries}\label{adding-act-boundaries}}

Now it would be useful to include information on act/scene boundaries in this plot. This can be done by supplying the original drama object as a second argument to the \texttt{plot()} function:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{utteranceStatistics}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{plot}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\CommentTok{# adding the `QDDrama` object here creates the act boundaries.}
       \DataTypeTok{main=}\KeywordTok{dramaNames}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)) }
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-20-1.pdf}

Please note that the information contained in this plot is very similar to the information in configuration matrices.

\hypertarget{who-how-often-collection}{%
\section{Collection analysis}\label{who-how-often-collection}}

In Version 3.0, the function \texttt{utteranceStatistics()} expects to be fed a QDDrama object that contains a single play (it will stop otherwise). It's still possible to run it over several plays at once, if the plays are in different objects but in a single list.

We again load the \emph{Sturm und Drang} plays as before, but we will use the function \texttt{split()} to separate the plays. This results in a list of \texttt{QDDrama} objects.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sturm_und_drang.ids <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"qd:11f81.0"}\NormalTok{, }\StringTok{"qd:11g1d.0"}\NormalTok{, }\StringTok{"qd:11g9w.0"}\NormalTok{, }
                         \StringTok{"qd:11hdv.0"}\NormalTok{, }\StringTok{"qd:nds0.0"}\NormalTok{,  }\StringTok{"qd:r12k.0"}\NormalTok{, }
                         \StringTok{"qd:r12v.0"}\NormalTok{,  }\StringTok{"qd:r134.0"}\NormalTok{,  }\StringTok{"qd:r13g.0"}\NormalTok{, }
                         \StringTok{"qd:rfxf.0"}\NormalTok{,  }\StringTok{"qd:rhtz.0"}\NormalTok{,  }\StringTok{"qd:rhzq.0"}\NormalTok{, }
                         \StringTok{"qd:rj22.0"}\NormalTok{,  }\StringTok{"qd:tx4z.0"}\NormalTok{,  }\StringTok{"qd:tz39.0"}\NormalTok{, }
                         \StringTok{"qd:tzgk.0"}\NormalTok{,  }\StringTok{"qd:v0fv.0"}\NormalTok{,  }\StringTok{"qd:wznj.0"}\NormalTok{, }
                         \StringTok{"qd:tx4z.0"}\NormalTok{,  }\StringTok{"qd:rfxf.0"}\NormalTok{)}

\NormalTok{sturm_und_drang.plays <-}\StringTok{ }\KeywordTok{loadDrama}\NormalTok{(sturm_und_drang.ids)}

\CommentTok{# separate the plays}
\NormalTok{sturm_und_drang.plays <-}\StringTok{ }\KeywordTok{split}\NormalTok{(sturm_und_drang.plays) }
\end{Highlighting}
\end{Shaded}

This list can of course be plotted again, but it will result in a number of individual plots.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\KeywordTok{length}\NormalTok{(sturm_und_drang.plays),}\DecValTok{1}\NormalTok{), }\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{15}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}

\KeywordTok{lapply}\NormalTok{(sturm_und_drang.plays, }
       \ControlFlowTok{function}\NormalTok{(x) \{}
         \KeywordTok{utteranceStatistics}\NormalTok{(x) }\OperatorTok{%>%}
\StringTok{           }\KeywordTok{format}\NormalTok{(x) }\OperatorTok{%>%}
\StringTok{           }\KeywordTok{plot}\NormalTok{(x, }\DataTypeTok{main=}\KeywordTok{dramaNames}\NormalTok{(x))}
\NormalTok{       \}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-22-1.pdf}

\hypertarget{configuration}{%
\chapter{Configuration}\label{configuration}}

\emph{This section does not refer to the configuration of the R-package, but to the literary analysis concept configuration matrix \citep{Pfister:1988aa}.}

\hypertarget{matrices}{%
\section{Matrices}\label{matrices}}

Configuration matrices can be extracted with the function \texttt{configuration()}. As usual, entering \texttt{?configuration} provies more detailed information about the options the function provides. This function can only deal with a single play at a time, but using \texttt{lappy()}, we can call it for many plays quickly (this the same we did with the function \texttt{utteranceStatistics()} \protect\hyperlink{who-how-often-collection}{above}).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{configuration}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    corpus  drama        character    1    2    3    4    5
## 1    test rksp.0        der_prinz 2740    0  945  803  815
## 2    test rksp.0 der_kammerdiener   42    0    0    0    0
## 3    test rksp.0            conti  764    0    0    0    0
## 4    test rksp.0        marinelli 1038  527 1814 1358  830
## 5    test rksp.0     camillo_rota  106    0    0    0    0
## 6    test rksp.0  claudia_galotti    0 1252  614  232    0
## 7    test rksp.0            pirro    0  343    0    0    0
## 8    test rksp.0          odoardo    0  611    0  706 1931
## 9    test rksp.0           angelo    0  385  250    0    0
## 10   test rksp.0           emilia    0 1166  413    0  696
## 11   test rksp.0          appiani    0 1112    0    0    0
## 16   test rksp.0         battista    0    0  187    8    0
## 22   test rksp.0           orsina    0    0    0 2832    0
\end{verbatim}

This creates a basic configuration matrix, but instead of just containing the presence or absence of a figure, it contains the number of spoken tokens for each act for each character. This information is in fact similar to what we can extract with \texttt{characterStatistics(rksp.0,\ segment="Act")}, but in a different form and structure. The above table contains a lot of information that can be visualised.

We first need to extract the numeric content from the above table. This can easily be done with the function \texttt{as.matrix()} (this will, in detail, be rerouted to the function \texttt{as.matrix.QDConfiguration()}, which knows what part of the table needs to be in the matrix). A matrix containing only numbers can easily be plotted using the regular \texttt{barplot()} function, as shown below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{c <-}\StringTok{ }\KeywordTok{configuration}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}

\NormalTok{mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(c)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{10}\NormalTok{))}

\KeywordTok{barplot}\NormalTok{(mat, }
        \DataTypeTok{legend.text =}\NormalTok{ c}\OperatorTok{$}\NormalTok{character,  }\CommentTok{# legend text}
        \DataTypeTok{args.legend =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{ncol}\NormalTok{(mat)}\OperatorTok{+}\DecValTok{3}\NormalTok{,      }\CommentTok{# legend x position}
                           \DataTypeTok{y=}\KeywordTok{max}\NormalTok{(}\KeywordTok{colSums}\NormalTok{(mat)) }\CommentTok{# legend y pos}
\NormalTok{                        ), }
        \DataTypeTok{col=}\NormalTok{qd.colors)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-24-1.pdf}

\hypertarget{filter}{%
\subsection{Filtering unimportant characters}\label{filter}}

This is informative, but doesn't look very nice and some colors are difficult to associate with characters because colors are repeating. We will therefore use the function \texttt{filter()}, which is very similar to \texttt{format()}: It can be applied to any object of the type \texttt{QDHasCharacter} and removes rows according to certain criteria. In this case, we filter every character except the five most talkative ones. As usual, see \texttt{?filter.QDHasCharacter} to see other options.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{c <-}\StringTok{ }\KeywordTok{configuration}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{n =} \DecValTok{5}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}

\NormalTok{mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(c)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{10}\NormalTok{))}

\KeywordTok{barplot}\NormalTok{(mat, }
        \DataTypeTok{names.arg =} \KeywordTok{as.roman}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(mat)),   }\CommentTok{# roman act numbers}
        \DataTypeTok{legend.text =}\NormalTok{ c}\OperatorTok{$}\NormalTok{character,  }\CommentTok{# legend text}
        \DataTypeTok{args.legend =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{ncol}\NormalTok{(mat)}\OperatorTok{+}\DecValTok{3}\NormalTok{,   }\CommentTok{# legend x position}
                           \DataTypeTok{y=}\KeywordTok{max}\NormalTok{(}\KeywordTok{colSums}\NormalTok{(mat)) }\CommentTok{# legend y pos}
\NormalTok{                        ), }
        \DataTypeTok{col=}\NormalTok{qd.colors)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-25-1.pdf}

Of course, the speech of characters that do not speak often is now removed, leaving only a portion of each act covered in the plot.

\hypertarget{normalization}{%
\subsection{Normalization}\label{normalization}}

Since each act has a different length, it is often useful to normalize each block, according to the total number of spoken tokens. This way, we can display the relative active presence of each character in each act. In combination with the filtering we did before, however, we need to be careful: If the scale with the filtered matrix, a certain portion of the character speech gets lost. The following snippet shows how to scale using the original matrix, but still only include the top eight characters into the matrix.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{c <-}\StringTok{ }\KeywordTok{configuration}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)   }\CommentTok{# getting the full configuration (with all characters)}
\NormalTok{mat_orig <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(c)     }\CommentTok{# extracting the matrix}

\NormalTok{c_filtered <-}\StringTok{ }\NormalTok{c }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{,}\DataTypeTok{n =} \DecValTok{8}\NormalTok{) }\CommentTok{# filtering, so that only the top 8 characters remain}
\NormalTok{mat_filtered <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(c_filtered)  }\CommentTok{# extracting the filtered matrix}

\CommentTok{# scaling, using values from the unfiltered matrix}
\NormalTok{mat <-}\StringTok{ }\KeywordTok{scale}\NormalTok{(mat_filtered, }
             \DataTypeTok{center=}\OtherTok{FALSE}\NormalTok{, }
             \DataTypeTok{scale=}\KeywordTok{colSums}\NormalTok{(mat_orig)) }

\CommentTok{# plot, as above}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{10}\NormalTok{))}
\KeywordTok{barplot}\NormalTok{(mat, }
        \DataTypeTok{names.arg =} \KeywordTok{as.roman}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(mat)),  }\CommentTok{# roman act numbers}
        \CommentTok{# legend}
        \DataTypeTok{legend.text=}\NormalTok{c_filtered}\OperatorTok{$}\NormalTok{character,            }\CommentTok{# set legend text}
        \DataTypeTok{args.legend =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{ncol}\NormalTok{(mat)}\OperatorTok{+}\DecValTok{3}\NormalTok{,      }\CommentTok{# legend x position}
                           \DataTypeTok{y=}\KeywordTok{max}\NormalTok{(}\KeywordTok{colSums}\NormalTok{(mat)) }\CommentTok{# legend y pos}
\NormalTok{                        ),}
        \CommentTok{# visual}
        \DataTypeTok{las=}\DecValTok{1}\NormalTok{,        }\CommentTok{# rotate labels on y axis}
        \DataTypeTok{col=}\NormalTok{qd.colors }\CommentTok{# provide colors}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-26-1.pdf}

\hypertarget{copresence}{%
\section{Copresence}\label{copresence}}

Configuration matrices are also often used to get an overview of who is copresent on stage. This can also be achieved using the function \texttt{configuration()}. First, we create a configuration matrix that only represents presence or absence of a figure (and we switch to scenes). Obviously, the resulting matrix has many more columns, we include only the first 10 below.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{configuration}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{onlyPresence =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{segment=}\StringTok{"Scene"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    corpus  drama        character     1     2     3     4     5     6
## 1    test rksp.0        der_prinz  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## 2    test rksp.0 der_kammerdiener  TRUE FALSE FALSE FALSE FALSE FALSE
## 4    test rksp.0            conti FALSE  TRUE FALSE  TRUE FALSE FALSE
## 9    test rksp.0        marinelli FALSE FALSE FALSE FALSE FALSE  TRUE
## 14   test rksp.0     camillo_rota FALSE FALSE FALSE FALSE FALSE FALSE
## 15   test rksp.0  claudia_galotti FALSE FALSE FALSE FALSE FALSE FALSE
## 16   test rksp.0            pirro FALSE FALSE FALSE FALSE FALSE FALSE
## 17   test rksp.0          odoardo FALSE FALSE FALSE FALSE FALSE FALSE
## 20   test rksp.0           angelo FALSE FALSE FALSE FALSE FALSE FALSE
## 25   test rksp.0           emilia FALSE FALSE FALSE FALSE FALSE FALSE
## 27   test rksp.0          appiani FALSE FALSE FALSE FALSE FALSE FALSE
## 47   test rksp.0         battista FALSE FALSE FALSE FALSE FALSE FALSE
## 65   test rksp.0           orsina FALSE FALSE FALSE FALSE FALSE FALSE
##        7
## 1   TRUE
## 2   TRUE
## 4  FALSE
## 9  FALSE
## 14 FALSE
## 15 FALSE
## 16 FALSE
## 17 FALSE
## 20 FALSE
## 25 FALSE
## 27 FALSE
## 47 FALSE
## 65 FALSE
\end{verbatim}

Creating a co-occurrence matrix is a simple matter of matrix multiplication, and we already know how to create a matrix.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# extract the configuration}
\NormalTok{c <-}\StringTok{ }\KeywordTok{configuration}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{onlyPresence =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{segment=}\StringTok{"Scene"}\NormalTok{) }

\CommentTok{# extract a matrix}
\NormalTok{mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(c)}

\CommentTok{# multiply the matrix with its inverse}
\CommentTok{# this creates the copresence matrix}
\NormalTok{copresence <-}\StringTok{ }\NormalTok{mat }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(mat) }

\CommentTok{# add character names}
\KeywordTok{rownames}\NormalTok{(copresence) <-}\StringTok{ }\NormalTok{c}\OperatorTok{$}\NormalTok{character}
\KeywordTok{colnames}\NormalTok{(copresence) <-}\StringTok{ }\NormalTok{c}\OperatorTok{$}\NormalTok{character}

\NormalTok{copresence}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                  der_prinz der_kammerdiener conti marinelli camillo_rota
## der_prinz               17                2     2         9            1
## der_kammerdiener         2                2     0         0            0
## conti                    2                0     2         0            0
## marinelli                9                0     0        19            0
## camillo_rota             1                0     0         0            1
## claudia_galotti          0                0     0         3            0
## pirro                    0                0     0         1            0
## odoardo                  2                0     0         4            0
## angelo                   0                0     0         1            0
## emilia                   2                0     0         4            0
## appiani                  0                0     0         2            0
## battista                 1                0     0         3            0
## orsina                   1                0     0         3            0
##                  claudia_galotti pirro odoardo angelo emilia appiani
## der_prinz                      0     0       2      0      2       0
## der_kammerdiener               0     0       0      0      0       0
## conti                          0     0       0      0      0       0
## marinelli                      3     1       4      1      4       2
## camillo_rota                   0     0       0      0      0       0
## claudia_galotti               13     3       3      0      3       4
## pirro                          3     4       1      1      0       1
## odoardo                        3     1      12      0      2       0
## angelo                         0     1       0      2      0       0
## emilia                         3     0       2      0      7       1
## appiani                        4     1       0      0      1       5
## battista                       2     0       0      0      1       0
## orsina                         1     0       3      0      0       0
##                  battista orsina
## der_prinz               1      1
## der_kammerdiener        0      0
## conti                   0      0
## marinelli               3      3
## camillo_rota            0      0
## claudia_galotti         2      1
## pirro                   0      0
## odoardo                 0      3
## angelo                  0      0
## emilia                  1      0
## appiani                 0      0
## battista                4      0
## orsina                  0      6
\end{verbatim}

The resulting copresence matrix shows the number of scenes in which two characters are both present. The diagonal shows the number of scenes in which a character is present in total (because each character is always copresent with itself, so to speak).

There are multiple ways to visualise this copresence. One option is a heat map, as shown below.

\hypertarget{as-heatmap}{%
\subsection{As Heatmap}\label{as-heatmap}}

The copresence can be visualised in a simple heat map. We first focus on the lower triangle and also remove the diagonal values. The actual plotting is a bit more complicated in this case, because we are just using the values in the copresence matrix as pixel intensities in the plot. Also, the axes need to be suppressed first, and can be added later with the proper names of the characters. If needed the code can also be used to include labels into the heat map.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{c <-}\StringTok{ }\KeywordTok{configuration}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{onlyPresence =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{segment=}\StringTok{"Scene"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{n =} \DecValTok{7}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}

\CommentTok{# extract a matrix}
\NormalTok{mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(c)}

\CommentTok{# multiply the matrix with its inverse}
\CommentTok{# this creates the copresence matrix}
\NormalTok{copresence <-}\StringTok{ }\NormalTok{mat }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(mat) }

\CommentTok{# add character names}
\KeywordTok{rownames}\NormalTok{(copresence) <-}\StringTok{ }\NormalTok{c}\OperatorTok{$}\NormalTok{character}
\KeywordTok{colnames}\NormalTok{(copresence) <-}\StringTok{ }\NormalTok{c}\OperatorTok{$}\NormalTok{character}

\CommentTok{# since it's a square matrix, we don't need the bottom right triangle}
\CommentTok{# and diagonales.}
\NormalTok{copresence[}\KeywordTok{lower.tri}\NormalTok{(copresence,}\DataTypeTok{diag=}\OtherTok{TRUE}\NormalTok{)] <-}\StringTok{ }\OtherTok{NA}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{)) }\CommentTok{# plot margins}
\KeywordTok{image}\NormalTok{(copresence, }
      \DataTypeTok{col =} \KeywordTok{rgb}\NormalTok{(}\DecValTok{256}\NormalTok{,}\DecValTok{111}\NormalTok{,}\DecValTok{184}\NormalTok{, }\DataTypeTok{alpha=}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{255}\NormalTok{)),}
                \DataTypeTok{maxColorValue =} \DecValTok{256}\NormalTok{),}
      \DataTypeTok{xaxt=} \StringTok{"n"}\NormalTok{,  }\CommentTok{# no x axis}
      \DataTypeTok{yaxt=} \StringTok{"n"}\NormalTok{,  }\CommentTok{# no y axis}
      \DataTypeTok{frame=}\OtherTok{TRUE}  \CommentTok{# print a frame around the heatmap}
\NormalTok{      )}

\CommentTok{# include values as labels}
\KeywordTok{text}\NormalTok{(}\DataTypeTok{y=}\NormalTok{(}\KeywordTok{rep}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(copresence), }\DataTypeTok{each=}\KeywordTok{nrow}\NormalTok{(copresence))}\OperatorTok{-}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(copresence)}\OperatorTok{-}\DecValTok{1}\NormalTok{),}
     \DataTypeTok{x=}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(copresence)}\OperatorTok{-}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(copresence)}\OperatorTok{-}\DecValTok{1}\NormalTok{),}
     \DataTypeTok{labels=}\KeywordTok{as.vector}\NormalTok{(copresence))}

\CommentTok{# add the x axis}
\KeywordTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DataTypeTok{at =} \KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DataTypeTok{length.out =} \KeywordTok{length}\NormalTok{(c}\OperatorTok{$}\NormalTok{character)), }\DataTypeTok{labels =}\NormalTok{ c}\OperatorTok{$}\NormalTok{character, }\DataTypeTok{las=}\DecValTok{3}\NormalTok{)}
\CommentTok{# add the y axis}
\KeywordTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DataTypeTok{at =} \KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DataTypeTok{length.out =} \KeywordTok{length}\NormalTok{(c}\OperatorTok{$}\NormalTok{character)), }\DataTypeTok{labels =}\NormalTok{ c}\OperatorTok{$}\NormalTok{character, }\DataTypeTok{las=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-30-1.pdf}

Apparently, Marinelli and the prince have the most shared scenes. Marinelli also shares a scene with most other figures (sum of the vertical bar: 16).

\hypertarget{network}{%
\subsection{As Network}\label{network}}

The same information can also be visualized as a copresence network. For this, we employ the R-package \texttt{igraph}. A nice introduction to \texttt{igraph} can be found in \citep{Arnold:2015aa}, particularly for literary networks.

Technically, the matrix we created before is an \href{https://en.wikipedia.org/wiki/Adjacency_matrix}{adjacency matrix}. It is therefore simple to convert it to a graph, and igraph offers the function \texttt{graph\_from\_adjacency\_matrix()} for this.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{c <-}\StringTok{ }\KeywordTok{configuration}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{onlyPresence =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{segment=}\StringTok{"Scene"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{n =} \DecValTok{7}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}

\CommentTok{# extract a matrix}
\NormalTok{mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(c)}

\CommentTok{# multiply the matrix with its inverse}
\CommentTok{# this creates the copresence matrix}
\NormalTok{copresence <-}\StringTok{ }\NormalTok{mat }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(mat) }

\CommentTok{# add character names}
\KeywordTok{rownames}\NormalTok{(copresence) <-}\StringTok{ }\NormalTok{c}\OperatorTok{$}\NormalTok{character}
\KeywordTok{colnames}\NormalTok{(copresence) <-}\StringTok{ }\NormalTok{c}\OperatorTok{$}\NormalTok{character}

\CommentTok{# convert the adjacency matrix to a graph object}
\NormalTok{g <-}\StringTok{ }\NormalTok{igraph}\OperatorTok{::}\KeywordTok{graph_from_adjacency_matrix}\NormalTok{(copresence, }
                                 \DataTypeTok{weighted=}\OtherTok{TRUE}\NormalTok{,     }\CommentTok{# weighted graph}
                                 \DataTypeTok{mode=}\StringTok{"undirected"}\NormalTok{, }\CommentTok{# no direction}
                                 \DataTypeTok{diag=}\OtherTok{FALSE}         \CommentTok{# no looping edges}
\NormalTok{                                )}
\end{Highlighting}
\end{Shaded}

Now the variable \texttt{g} holds the graph object. There are different things we can do with the graph. First, we can visualise it. \texttt{igraph} uses the same mechanism of R that we have used before for plotting, specifying a \texttt{plot()} function that can plot graph objects.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Now we plot}
\KeywordTok{plot}\NormalTok{(g, }
     \DataTypeTok{layout=}\NormalTok{layout_with_gem,       }\CommentTok{# how to lay out the graph}
     \DataTypeTok{main=}\StringTok{"Copresence Network: Emilia Galotti"}\NormalTok{,  }\CommentTok{# title}
     \DataTypeTok{vertex.label.cex=}\FloatTok{0.8}\NormalTok{,         }\CommentTok{# label size}
     \DataTypeTok{vertex.label.color=}\StringTok{"black"}\NormalTok{,   }\CommentTok{# font color}
     \DataTypeTok{vertex.color=}\NormalTok{qd.colors[}\DecValTok{6}\NormalTok{],    }\CommentTok{# vertex color}
     \DataTypeTok{vertex.frame.color=}\OtherTok{NA}\NormalTok{,        }\CommentTok{# no vertex border}
     \DataTypeTok{edge.width=}\KeywordTok{E}\NormalTok{(g)}\OperatorTok{$}\NormalTok{weight        }\CommentTok{# scale edges according to their weight}
\NormalTok{)  }
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-32-1.pdf}

\hypertarget{network-properties}{%
\subsection{Network properties}\label{network-properties}}

\texttt{igraph} offers a number of function to extract graph properties. We will show them below without explanation. The documentation of each function can be found \href{https://igraph.org/r/doc/}{here}.

\hypertarget{density}{%
\subsubsection{Density}\label{density}}

Function: \href{https://igraph.org/r/doc/edge_density.html}{\texttt{graph.density()}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{graph.density}\NormalTok{(g)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.7619048
\end{verbatim}

\hypertarget{average-nearest-neighbor-degree}{%
\subsubsection{Average nearest neighbor degree}\label{average-nearest-neighbor-degree}}

Function: \href{https://igraph.org/r/doc/knn.html}{\texttt{knn()}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{knn}\NormalTok{(g)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $knn
##       Der Prinz       Marinelli         Claudia Odoardo Galotti 
##        4.214286        2.760000        4.714286        5.214286 
##          Emilia         Appiani          Orsina 
##        6.166667        7.285714        8.375000 
## 
## $knnk
## [1]      NaN      NaN 7.285714 6.294643 5.365079 2.760000
\end{verbatim}

\hypertarget{edge-connectivity}{%
\subsubsection{Edge connectivity}\label{edge-connectivity}}

Function: \href{https://igraph.org/r/doc/edge_connectivity.html}{\texttt{edge\_connectivity()}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{edge_connectivity}\NormalTok{(g)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3
\end{verbatim}

\hypertarget{graph-export}{%
\subsection{Graph Export}\label{graph-export}}

As a final step, one might want to further work on the graph using \href{https://gephi.org}{Gephi}, or other tools. In order to do so, one can export the graph into an appropriate file:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{igraph}\OperatorTok{::}\KeywordTok{write_graph}\NormalTok{(g, }
                    \StringTok{"rksp.0.graphml"}\NormalTok{,    }\CommentTok{# specify the file name}
                    \DataTypeTok{format=}\StringTok{"graphml"}     \CommentTok{# specify the file format}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This results in a file called \href{rksp.0.graphml}{\texttt{rksp.0.graphml}}, that starts similarly as this:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{<?xml}\NormalTok{ version="1.0" encoding="UTF-8"}\KeywordTok{?>}
\KeywordTok{<graphml}\OtherTok{ xmlns=}\StringTok{"http://graphml.graphdrawing.org/xmlns"}
\OtherTok{         xmlns:xsi=}\StringTok{"http://www.w3.org/2001/XMLSchema-instance"}
\OtherTok{         xsi:schemaLocation=}\StringTok{"http://graphml.graphdrawing.org/xmlns}
\StringTok{         http://graphml.graphdrawing.org/xmlns/1.0/graphml.xsd"}\KeywordTok{>}
\CommentTok{<!-- Created by igraph -->}
  \KeywordTok{<key}\OtherTok{ id=}\StringTok{"v_name"}\OtherTok{ for=}\StringTok{"node"}\OtherTok{ attr.name=}\StringTok{"name"}\OtherTok{ attr.type=}\StringTok{"string"}\KeywordTok{/>}
  \KeywordTok{<key}\OtherTok{ id=}\StringTok{"e_weight"}\OtherTok{ for=}\StringTok{"edge"}\OtherTok{ attr.name=}\StringTok{"weight"}\OtherTok{ attr.type=}\StringTok{"double"}\KeywordTok{/>}
  \KeywordTok{<graph}\OtherTok{ id=}\StringTok{"G"}\OtherTok{ edgedefault=}\StringTok{"undirected"}\KeywordTok{>}
    \KeywordTok{<node}\OtherTok{ id=}\StringTok{"n0"}\KeywordTok{>}
      \KeywordTok{<data}\OtherTok{ key=}\StringTok{"v_name"}\KeywordTok{>}\NormalTok{DER KAMMERDIENER}\KeywordTok{</data>}
    \KeywordTok{</node>}
    \KeywordTok{<node}\OtherTok{ id=}\StringTok{"n1"}\KeywordTok{>}
      \KeywordTok{<data}\OtherTok{ key=}\StringTok{"v_name"}\KeywordTok{>}\NormalTok{DER PRINZ}\KeywordTok{</data>}
    \KeywordTok{</node>}
\NormalTok{    ...}
\end{Highlighting}
\end{Shaded}

This file can be opened with Gephi.

\hypertarget{character-exchange}{%
\chapter{Character Exchange}\label{character-exchange}}

Character exchange -- entering and leaving the stage -- often takes place at scene boundaries. We offer multiple ways to measure and visualize this exchange over the course of the play.

\hypertarget{hamming-distance}{%
\section{Hamming Distance}\label{hamming-distance}}

The \href{https://en.wikipedia.org/wiki/Hamming_distance}{hamming distance} has been introduced in information theory by Richard Hamming \citep{Hamming:1950aa}. Intuitively, the hamming distance expresses the number of characters that either enter or leave the stage. Its application to a dramatic text is straightforward, using the function \texttt{hamming()}. By default, the hamming distance is calculated over scene boundaries.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{hamming}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{variant=}\StringTok{"Hamming"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 2 1 1 1 1 2 2 4 2 4 3 2 1 1 1 2 2 2 4 2 2 3 2 4 1 3 3 1 3 2 2 1 1 1 5
## [36] 3 1 1 2 2 1 2
\end{verbatim}

The return value of the function is just a vector of numbers, one less than the number of scenes in the play. Of course, this can be plotted:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\KeywordTok{hamming}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{variant=}\StringTok{"Hamming"}\NormalTok{),}
     \DataTypeTok{type=}\StringTok{"l"}\NormalTok{,}
     \DataTypeTok{ylab=}\StringTok{"Hamming distance"}\NormalTok{,}
     \DataTypeTok{xlab=}\StringTok{"Scenes"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-38-1.pdf}

Hamming distance, in its original definition as well as the \texttt{Hamming} variant in our function, returns absolute values. As usual, these values should be normalized, and the function \texttt{hamming()} provides two ways of doing that.

\hypertarget{normalizedhamming}{%
\subsection{NormalizedHamming}\label{normalizedhamming}}

Straightforwardly, one can normalise by the overall number of characters in the play. This value is only maximal, if at once scene boundary, one subset of characters enters the stage, and the entire other subset leaves the stage. As we can see below, this is not the case in our demo text.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{hamming}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{variant=}\StringTok{"NormalizedHamming"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 0.15384615 0.07692308 0.07692308 0.07692308 0.07692308 0.15384615
##  [7] 0.15384615 0.30769231 0.15384615 0.30769231 0.23076923 0.15384615
## [13] 0.07692308 0.07692308 0.07692308 0.15384615 0.15384615 0.15384615
## [19] 0.30769231 0.15384615 0.15384615 0.23076923 0.15384615 0.30769231
## [25] 0.07692308 0.23076923 0.23076923 0.07692308 0.23076923 0.15384615
## [31] 0.15384615 0.07692308 0.07692308 0.07692308 0.38461538 0.23076923
## [37] 0.07692308 0.07692308 0.15384615 0.15384615 0.07692308 0.15384615
\end{verbatim}

\hypertarget{trilcke}{%
\subsection{Trilcke}\label{trilcke}}

One more possible normalization has been proposed by \citet{Trilcke:2017ab}. Instead of normalizing with all characters in the play, the Trilcke variant only normalizes with the characters in the two adjacent scenes. Thus, if all characters leave the stage, and a new set of characters enter it, the distance is maximal. This however does not have to include \emph{all} characters in the play.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{hamming}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{variant=}\StringTok{"Trilcke"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 0.6666667 0.5000000 0.5000000 0.5000000 0.5000000 0.6666667 0.6666667
##  [8] 1.0000000 0.6666667 1.0000000 0.7500000 0.6666667 0.5000000 0.3333333
## [15] 0.3333333 0.5000000 0.5000000 0.6666667 1.0000000 0.6666667 0.6666667
## [22] 0.7500000 0.5000000 0.8000000 0.3333333 0.7500000 0.7500000 0.3333333
## [29] 0.7500000 0.6666667 0.6666667 0.3333333 0.3333333 0.3333333 1.0000000
## [36] 1.0000000 0.5000000 0.5000000 0.6666667 0.6666667 0.5000000 0.5000000
\end{verbatim}

The Trilcke variant is the default setting of the \texttt{hamming()}-function.

\hypertarget{corpus-analysis}{%
\section{Corpus Analysis}\label{corpus-analysis}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sturm_und_drang.ids <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"qd:11f81.0"}\NormalTok{, }\StringTok{"qd:11g1d.0"}\NormalTok{, }\StringTok{"qd:11g9w.0"}\NormalTok{, }
                         \StringTok{"qd:11hdv.0"}\NormalTok{, }\StringTok{"qd:nds0.0"}\NormalTok{,  }\StringTok{"qd:r12k.0"}\NormalTok{, }
                         \StringTok{"qd:r12v.0"}\NormalTok{,  }\StringTok{"qd:r134.0"}\NormalTok{,  }\StringTok{"qd:r13g.0"}\NormalTok{, }
                         \StringTok{"qd:rfxf.0"}\NormalTok{,  }\StringTok{"qd:rhtz.0"}\NormalTok{,  }\StringTok{"qd:rhzq.0"}\NormalTok{, }
                         \StringTok{"qd:rj22.0"}\NormalTok{,  }\StringTok{"qd:tx4z.0"}\NormalTok{,  }\StringTok{"qd:tz39.0"}\NormalTok{, }
                         \StringTok{"qd:tzgk.0"}\NormalTok{,  }\StringTok{"qd:v0fv.0"}\NormalTok{,  }\StringTok{"qd:wznj.0"}\NormalTok{, }
                         \StringTok{"qd:tx4z.0"}\NormalTok{,  }\StringTok{"qd:rfxf.0"}\NormalTok{)}

\NormalTok{sturm_und_drang.plays <-}\StringTok{ }\KeywordTok{loadDrama}\NormalTok{(sturm_und_drang.ids)}
\end{Highlighting}
\end{Shaded}

Since determining character exchanges at scene boundaries is not a multi-play task, the function \texttt{hamming()} does not allow \texttt{QDDrama} objects that contain multiple plays. It's still possible to calculate the exchanges for many plays though, using \texttt{split()} and \texttt{lapply()}. \texttt{split()} is a function defined in the \texttt{DramaAnalysis} package and can be used to split up a \texttt{QDDrama} object if it contains multiple plays. It returns a list of individual objects. This list is then fed into the function \texttt{lapply()}, which applies the function \texttt{hamming()} on each element of the list.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{profiles <-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(}\KeywordTok{split}\NormalTok{(sturm_und_drang.plays), hamming, }\DataTypeTok{variant =} \StringTok{"Trilcke"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The result of this is a list that contains an entry for each play, which in turn reflects the distances at specific scene boundaries. Thus, the lists have different lengths, as the plays have different lengths. We apply the same trick with \texttt{lappy()} to create plots of all the plays. Instead of calling a pre-existing function (as before with \texttt{hamming()}), we define a new (anonymous) function. This is mainly to allow printing the authors and names of the play into the plots.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\KeywordTok{length}\NormalTok{(profiles),}\DecValTok{1}\NormalTok{), }\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}

\KeywordTok{lapply}\NormalTok{(}\KeywordTok{names}\NormalTok{(profiles), }
       \ControlFlowTok{function}\NormalTok{(x) \{}
         \KeywordTok{plot}\NormalTok{(profiles[[x]],  }\CommentTok{# take the data}
              \DataTypeTok{type=}\StringTok{"l"}\NormalTok{,       }\CommentTok{# we print lines}
              \DataTypeTok{ylab=}\StringTok{"Character exchange rate"}\NormalTok{, }\CommentTok{# y axis label }
              \DataTypeTok{ylim=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{),                    }\CommentTok{# y axis scale}
              \CommentTok{# create nice labels}
              \DataTypeTok{main=}\KeywordTok{paste}\NormalTok{(sturm_und_drang.plays}\OperatorTok{$}\NormalTok{meta[drama}\OperatorTok{==}\NormalTok{x,]}\OperatorTok{$}\NormalTok{Name,}
\NormalTok{                         sturm_und_drang.plays}\OperatorTok{$}\NormalTok{meta[drama}\OperatorTok{==}\NormalTok{x,]}\OperatorTok{$}\NormalTok{documentTitle, }
                         \DataTypeTok{sep=}\StringTok{": "}\NormalTok{, }\DataTypeTok{collapse=}\StringTok{": "}\NormalTok{)}
\NormalTok{         )}
\NormalTok{       \}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-43-1.pdf}

\hypertarget{word-field-analysis}{%
\chapter{Word Field Analysis}\label{word-field-analysis}}

What we consider a word field here may differ from specific uses in linguistics. In this context, a word field is a list of words that belong to a common theme / topic / semantic group. Multiple word fields can be assembled to create a dictionary. On a technical level, what we describe in the following works for arbitrary lists of words. A semantic relation between the words is technically not required. Thus, the following pieces of code can be used with arbitrary word lists.

For \textbf{demo purposes} (this is really a toy example), we will define the word field of \texttt{Love} as containing the words \texttt{Liebe} (love) and \texttt{Herz} (heart).
In R, we can put them in a character vector, and we use lemmas:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wf_love <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"liebe"}\NormalTok{, }\StringTok{"herz"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

We will test this word field on Emilia Galotti, which should be about love.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(}\StringTok{"rksp.0"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{single-word-field}{%
\section{Single word field}\label{single-word-field}}

The core of the word field analysis is collecting statistics about a dictionary. Therefore, we use the function called \texttt{dictionaryStatisticsSingle()} (single, because we only want to analyse a single word field):

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dictionaryStatisticsSingle}\NormalTok{(}
\NormalTok{  rksp}\FloatTok{.0}\NormalTok{,              }\CommentTok{# the text we want to process}
  \DataTypeTok{wordfield=}\NormalTok{wf_love    }\CommentTok{# the word field}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    corpus  drama        character x
## 1    test rksp.0           angelo 0
## 2    test rksp.0          appiani 0
## 3    test rksp.0         battista 0
## 4    test rksp.0     camillo_rota 0
## 5    test rksp.0  claudia_galotti 2
## 6    test rksp.0            conti 2
## 7    test rksp.0 der_kammerdiener 0
## 8    test rksp.0        der_prinz 9
## 9    test rksp.0           emilia 5
## 10   test rksp.0        marinelli 8
## 11   test rksp.0          odoardo 7
## 12   test rksp.0           orsina 5
## 13   test rksp.0            pirro 0
\end{verbatim}

What this table shows us the number of times the characters in the play use words that appear in this list. By default, these are absolute numbers.

We can visualise these counts in a simple bar chart:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# retrieve counts and replace character ids by names}
\NormalTok{dstat <-}\StringTok{ }\KeywordTok{dictionaryStatisticsSingle}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{wordfield =}\NormalTok{ wf_love) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{format}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}

\CommentTok{# remove figures not using these words at all}
\NormalTok{dstat <-}\StringTok{ }\NormalTok{dstat[dstat}\OperatorTok{$}\NormalTok{x}\OperatorTok{>}\DecValTok{0}\NormalTok{,]}

\CommentTok{# create a bar plot}
\KeywordTok{barplot}\NormalTok{(dstat}\OperatorTok{$}\NormalTok{x,                      }\CommentTok{# what to plot}
        \DataTypeTok{names.arg =}\NormalTok{ dstat}\OperatorTok{$}\NormalTok{character,  }\CommentTok{# x axis labels}
        \DataTypeTok{las=}\DecValTok{2}                         \CommentTok{# turn axis labels}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-47-1.pdf}

Apparently, the prince and Marinelli are mentioning these words a lot more than the other characters.

When comparing characters, it often (but not always) makes sense to normalize the counts according to the total number of spoken words by a character. This can be enabled by setting the argument \texttt{normalizeByFigure=TRUE}. This will divide the number of words in this field by the total number of words a character speaks.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dstat <-}\StringTok{ }\KeywordTok{dictionaryStatisticsSingle}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }\DataTypeTok{wordfield=}\NormalTok{wf_love,}
  \DataTypeTok{normalizeByFigure =} \OtherTok{TRUE}   \CommentTok{# apply normalization}
\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{format}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)         }\CommentTok{# reformat character names}

\CommentTok{# remove figures not using these words at all}
\NormalTok{dstat <-}\StringTok{ }\NormalTok{dstat[dstat}\OperatorTok{$}\NormalTok{x}\OperatorTok{>}\DecValTok{0}\NormalTok{,]}

\KeywordTok{barplot}\NormalTok{(dstat}\OperatorTok{$}\NormalTok{x, }
        \DataTypeTok{names.arg =}\NormalTok{ dstat}\OperatorTok{$}\NormalTok{character, }
        \DataTypeTok{las=}\DecValTok{2}            
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-48-1.pdf}

\hypertarget{multiple-word-fields}{%
\section{Multiple Word Fields}\label{multiple-word-fields}}

The function \texttt{dictionaryStatistics()} can be used to analyse multiple dictionaries at once. To this end, dictionaries are represented as lists of character vectors. The (named) outer list contains the keywords, the vectors are just words associated with the keyword.

New dictionaries can be easily created like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wf <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{Liebe=}\KeywordTok{c}\NormalTok{(}\StringTok{"liebe"}\NormalTok{,}\StringTok{"herz"}\NormalTok{,}\StringTok{"schmerz"}\NormalTok{), }\DataTypeTok{Hass=}\KeywordTok{c}\NormalTok{(}\StringTok{"hass"}\NormalTok{,}\StringTok{"hassen"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

This dictionary contains the two entries \texttt{Liebe} (love) and \texttt{Hass} (hate), with 3 respective 2 entries. Dictionaries can be created in code, like shown above. In addition, the function \texttt{loadFields()} can be used to download dictionary content from a URL or a directory. By default, the function loads \href{https://github.com/quadrama/metadata/tree/master/fields/}{this dictionary} from GitHub (that we used in publications), for the keywords \texttt{Liebe} and \texttt{Familie} (family). Since version 2.3.0, this dictionary is included in the package as \texttt{base\_dictionary} and can be used right away (without internet connection). It is also the default dictionary used by \texttt{dictionaryStatistics()}.

The function \texttt{loadFields()} offers parameters to load from different URLs via http or to load from plain text files that are stored locally. The latter can be achieved by specifying the directory as \texttt{baseurl}. Entries for each keyword should then be stored in a file named like the keyword, and ending with \texttt{txt} (by default, can be overwritten). See \texttt{?loadFields} for details. Some of the options can also be specified through \texttt{dictionaryStatistics()}, as exemplified below.

The following examples use the \texttt{base\_dictionary}, i.e., a specific version of the fields we have been using in QuaDramA.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dstat <-}\StringTok{ }\KeywordTok{dictionaryStatistics}\NormalTok{(}
\NormalTok{  rksp}\FloatTok{.0}\NormalTok{,  }\CommentTok{# the text}
  \DataTypeTok{fieldnames =} \CommentTok{# fields we want to measure (from base_dictionary)}
    \KeywordTok{c}\NormalTok{(}\StringTok{"Liebe"}\NormalTok{, }\StringTok{"Familie"}\NormalTok{, }\StringTok{"Ratio"}\NormalTok{, }\StringTok{"Krieg"}\NormalTok{, }\StringTok{"Religion"}\NormalTok{),}
  \DataTypeTok{normalizeByFigure =} \OtherTok{TRUE}\NormalTok{,   }\CommentTok{# normalization by figure}
  \DataTypeTok{normalizeByField =} \OtherTok{TRUE}     \CommentTok{# normalization by field}
\NormalTok{)}
\NormalTok{dstat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    corpus  drama        character        Liebe      Familie        Ratio
## 1    test rksp.0           angelo 5.025967e-05 6.471794e-05 7.290755e-05
## 2    test rksp.0          appiani 8.610133e-05 1.355080e-04 6.661338e-05
## 3    test rksp.0         battista 0.000000e+00 1.404988e-04 0.000000e+00
## 4    test rksp.0     camillo_rota 1.003613e-04 1.292324e-04 4.367575e-04
## 5    test rksp.0  claudia_galotti 7.606028e-05 2.350575e-04 3.972037e-05
## 6    test rksp.0            conti 1.531692e-04 5.379043e-05 3.635835e-05
## 7    test rksp.0 der_kammerdiener 0.000000e+00 0.000000e+00 0.000000e+00
## 8    test rksp.0        der_prinz 7.021317e-05 6.974600e-05 5.238125e-05
## 9    test rksp.0           emilia 8.417115e-05 3.311757e-04 4.884005e-05
## 10   test rksp.0        marinelli 8.026020e-05 1.550231e-04 4.657073e-05
## 11   test rksp.0          odoardo 5.895608e-05 2.361833e-04 6.556741e-05
## 12   test rksp.0           orsina 5.259046e-05 1.160901e-04 5.231220e-05
## 13   test rksp.0            pirro 0.000000e+00 1.996885e-04 5.398985e-05
##           Krieg     Religion
## 1  5.624297e-05 0.000000e+00
## 2  4.817575e-05 0.000000e+00
## 3  0.000000e+00 0.000000e+00
## 4  8.423181e-05 0.000000e+00
## 5  4.681329e-05 8.362183e-05
## 6  2.337322e-05 0.000000e+00
## 7  0.000000e+00 0.000000e+00
## 8  2.862261e-05 3.969947e-05
## 9  3.139717e-05 1.002506e-04
## 10 3.849213e-05 1.890842e-05
## 11 4.123417e-05 5.401435e-05
## 12 2.522195e-05 1.238973e-05
## 13 0.000000e+00 1.022966e-04
\end{verbatim}

The variable \texttt{dstat} now contains multiple columns, one for each word field. We have been using the option \texttt{normalizeByFigure} before. When comparing multiple fields, it often happens that they have a different size (i.e., different number of words). In this case, it makes sense to \emph{also} normalize with the number of words in the word field. This is achieved by \texttt{normalizeByField=TRUE}. This makes the numbers very small, but they should be used in comparison anyway.

\hypertarget{bar-plot-by-character}{%
\subsection{Bar plot by character}\label{bar-plot-by-character}}

It is now straightforward to show the distribution of fields for a single character:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(dstat)}

\KeywordTok{barplot}\NormalTok{(mat[}\DecValTok{9}\NormalTok{,],     }\CommentTok{# we select Emilia's line}
        \DataTypeTok{main=}\StringTok{"Emilia's speech"}\NormalTok{,}
        \DataTypeTok{names.arg=}\KeywordTok{colnames}\NormalTok{(mat)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-51-1.pdf}

\hypertarget{bar-plot-by-field}{%
\subsection{Bar plot by field}\label{bar-plot-by-field}}

Conversely, we can also show who uses words of a certain field how often:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dstat <-}\StringTok{ }\KeywordTok{dictionaryStatistics}\NormalTok{(}
\NormalTok{  rksp}\FloatTok{.0}\NormalTok{,  }\CommentTok{# the text}
  \DataTypeTok{fieldnames =} \CommentTok{# fields we want to measure (from base_dictionary)}
    \KeywordTok{c}\NormalTok{(}\StringTok{"Liebe"}\NormalTok{, }\StringTok{"Familie"}\NormalTok{, }\StringTok{"Ratio"}\NormalTok{, }\StringTok{"Krieg"}\NormalTok{, }\StringTok{"Religion"}\NormalTok{),}
  \DataTypeTok{normalizeByFigure =} \OtherTok{TRUE}\NormalTok{,   }\CommentTok{# normalization by figure}
  \DataTypeTok{normalizeByField =} \OtherTok{TRUE}     \CommentTok{# normalization by field}
\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{format}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}
  
\NormalTok{mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(dstat)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{9}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}

\KeywordTok{barplot}\NormalTok{(mat[,}\DecValTok{1}\NormalTok{],                  }\CommentTok{# Select the row for 'love'}
        \DataTypeTok{main=}\StringTok{"Use of love words"}\NormalTok{, }\CommentTok{# title for plot}
        \DataTypeTok{beside =} \OtherTok{TRUE}\NormalTok{,            }\CommentTok{# not stacked}
        \DataTypeTok{names.arg =}\NormalTok{ dstat}\OperatorTok{$}\NormalTok{character,   }\CommentTok{# x axis labels}
        \DataTypeTok{las=}\DecValTok{2}                     \CommentTok{# rotation for labels}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-52-1.pdf}

\hypertarget{dictionary-based-distance}{%
\section{Dictionary Based Distance}\label{dictionary-based-distance}}

Technically, the output of \texttt{dictionaryStatistics()} is a \texttt{data.frame}. This is suitable for most uses. In some cases, however, it's more suited to work with a matrix that only contains the raw numbers (i.e., number of family words). Calculating character distance based on dictionaries, for instance. For these cases, the package provides an S3 method that extracts the numeric part of the data.frame and creates a matrix. We have used this function \texttt{as.matrix()} already above.

The matrix doesn't have row names by default. The snippet below can be used to add row names.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds <-}\StringTok{ }\KeywordTok{dictionaryStatistics}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }
                            \DataTypeTok{fieldnames=}\KeywordTok{c}\NormalTok{(}\StringTok{"Liebe"}\NormalTok{, }\StringTok{"Familie"}\NormalTok{, }\StringTok{"Ratio"}\NormalTok{, }\StringTok{"Krieg"}\NormalTok{, }\StringTok{"Religion"}\NormalTok{),}
                            \DataTypeTok{normalizeByFigure=}\OtherTok{TRUE}\NormalTok{)}
\NormalTok{m <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(ds)}
\KeywordTok{rownames}\NormalTok{(m) <-}\StringTok{ }\NormalTok{ds}\OperatorTok{$}\NormalTok{character}
\NormalTok{m}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                        Liebe     Familie       Ratio       Krieg
## angelo           0.004724409 0.004724409 0.007874016 0.006299213
## appiani          0.008093525 0.009892086 0.007194245 0.005395683
## battista         0.000000000 0.010256410 0.000000000 0.000000000
## camillo_rota     0.009433962 0.009433962 0.047169811 0.009433962
## claudia_galotti  0.007149666 0.017159199 0.004289800 0.005243089
## conti            0.014397906 0.003926702 0.003926702 0.002617801
## der_kammerdiener 0.000000000 0.000000000 0.000000000 0.000000000
## der_prinz        0.006600038 0.005091458 0.005657175 0.003205733
## emilia           0.007912088 0.024175824 0.005274725 0.003516484
## marinelli        0.007544458 0.011316688 0.005029639 0.004311119
## odoardo          0.005541872 0.017241379 0.007081281 0.004618227
## orsina           0.004943503 0.008474576 0.005649718 0.002824859
## pirro            0.000000000 0.014577259 0.005830904 0.000000000
##                      Religion
## angelo           0.0000000000
## appiani          0.0000000000
## battista         0.0000000000
## camillo_rota     0.0000000000
## claudia_galotti  0.0047664442
## conti            0.0000000000
## der_kammerdiener 0.0000000000
## der_prinz        0.0022628701
## emilia           0.0057142857
## marinelli        0.0010777798
## odoardo          0.0030788177
## orsina           0.0007062147
## pirro            0.0058309038
\end{verbatim}

Every character is now represented with five numbers, which can be interpreted as a vector in five-dimensional space. This means, we can easily apply distance metrics supplied by the function \texttt{dist()} (from the default package \texttt{stats}). By default, \texttt{dist()} calculates \href{https://en.wikipedia.org/wiki/Euclidean_distance}{Euclidean distance}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cdist <-}\StringTok{ }\KeywordTok{dist}\NormalTok{(m)}
\CommentTok{# output not shown}
\end{Highlighting}
\end{Shaded}

The resulting data structure is similar to the one in the weighted configuration matrix, which means everything from \protect\hyperlink{network}{Section 5.2.2} can be applied here.
In particular, we can convert these distances into a network:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(igraph)}
\NormalTok{g <-}\StringTok{ }\KeywordTok{graph_from_adjacency_matrix}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(cdist), }
                                 \DataTypeTok{weighted=}\OtherTok{TRUE}\NormalTok{,     }\CommentTok{# weighted graph}
                                 \DataTypeTok{mode=}\StringTok{"undirected"}\NormalTok{, }\CommentTok{# no direction}
                                 \DataTypeTok{diag=}\OtherTok{FALSE}         \CommentTok{# no looping edges}
\NormalTok{                                )}
\end{Highlighting}
\end{Shaded}

This network can of course be visualised again.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Now we plot}
\KeywordTok{plot.igraph}\NormalTok{(g, }
            \DataTypeTok{layout=}\NormalTok{layout_with_fr,       }\CommentTok{# how to lay out the graph}
            \DataTypeTok{main=}\StringTok{"Dictionary distance network"}\NormalTok{,  }\CommentTok{# title}
            \DataTypeTok{vertex.label.cex=}\FloatTok{0.6}\NormalTok{,         }\CommentTok{# label size}
            \DataTypeTok{vertex.label.color=}\StringTok{"black"}\NormalTok{,   }\CommentTok{# font color}
            \DataTypeTok{vertex.color=}\NormalTok{qd.colors[}\DecValTok{5}\NormalTok{],    }\CommentTok{# vertex color}
            \DataTypeTok{vertex.frame.color=}\OtherTok{NA}\NormalTok{,        }\CommentTok{# no vertex border}
            \DataTypeTok{edge.width=}\KeywordTok{E}\NormalTok{(g)}\OperatorTok{$}\NormalTok{weight}\OperatorTok{*}\DecValTok{100}    \CommentTok{# scale edges according to their weight }
                                          \CommentTok{# (since the distances are so small, we multiply)}
\NormalTok{            )  }
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-56-1.pdf}

Although this network is similar to the one shown in \protect\hyperlink{network}{Section 5.2.2} (both undirected and weighted), it displays a totally different kind of information. The networks based on copresence connect characters that appear together on stage, while this network connects characters with similar thematic profile in their speech (within the limits of being able to detect thematic profiles via word fields).

\hypertarget{development-over-the-course-of-the-play}{%
\section{Development over the course of the play}\label{development-over-the-course-of-the-play}}

Finally, the function \texttt{dictionaryStatistics()} can be used to track word field for segments of the play. To do that, we use the parameter \texttt{segment}, and set it to either ``Act'' or ``Scene''.

\hypertarget{individual-characters}{%
\subsection{Individual characters}\label{individual-characters}}

We can now plot the theme progress over the course of the play. This can be done for specific characters, as shown below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dsl <-}\StringTok{ }\KeywordTok{dictionaryStatistics}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }
                            \DataTypeTok{fieldnames=}\KeywordTok{c}\NormalTok{(}\StringTok{"Liebe"}\NormalTok{, }\StringTok{"Familie"}\NormalTok{, }\StringTok{"Ratio"}\NormalTok{, }\StringTok{"Krieg"}\NormalTok{, }\StringTok{"Religion"}\NormalTok{),}
                            \DataTypeTok{normalizeByFigure=}\OtherTok{TRUE}\NormalTok{,}
                            \DataTypeTok{segment=}\StringTok{"Act"}\NormalTok{)}

\NormalTok{mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(dsl[dsl}\OperatorTok{$}\NormalTok{character}\OperatorTok{==}\StringTok{"marinelli"}\NormalTok{,])}

\KeywordTok{matplot}\NormalTok{(mat, }\DataTypeTok{type=}\StringTok{"l"}\NormalTok{, }\DataTypeTok{col=}\StringTok{"black"}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\DataTypeTok{x=}\StringTok{"topleft"}\NormalTok{,}\DataTypeTok{legend=}\KeywordTok{colnames}\NormalTok{(mat), }\DataTypeTok{lty=}\DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(dsl))}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-57-1.pdf}

Depending on the use case, it might be easier to interpret if the numbers are cumulatively added up. The snippet below shows how this works.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dsl <-}\StringTok{ }\KeywordTok{dictionaryStatistics}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }
                            \DataTypeTok{fieldnames=}\KeywordTok{c}\NormalTok{(}\StringTok{"Liebe"}\NormalTok{, }\StringTok{"Familie"}\NormalTok{, }\StringTok{"Ratio"}\NormalTok{, }\StringTok{"Krieg"}\NormalTok{, }\StringTok{"Religion"}\NormalTok{),}
                            \DataTypeTok{normalizeByFigure=}\OtherTok{TRUE}\NormalTok{,}
                            \DataTypeTok{segment=}\StringTok{"Act"}\NormalTok{) }

\NormalTok{mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(dsl[dsl}\OperatorTok{$}\NormalTok{character}\OperatorTok{==}\StringTok{"marinelli"}\NormalTok{,])}

\NormalTok{mat <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(mat,}\DecValTok{2}\NormalTok{,cumsum)}

\KeywordTok{matplot}\NormalTok{(mat, }\DataTypeTok{type=}\StringTok{"l"}\NormalTok{, }\DataTypeTok{col=}\StringTok{"black"}\NormalTok{)}

\CommentTok{# Add act lines}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{v=}\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(mat))}

\KeywordTok{legend}\NormalTok{(}\DataTypeTok{x=}\StringTok{"topleft"}\NormalTok{, }\DataTypeTok{legend=}\KeywordTok{colnames}\NormalTok{(mat), }\DataTypeTok{lty=}\DecValTok{1}\OperatorTok{:}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-58-1.pdf}

\hypertarget{comparing-characters}{%
\subsection{Comparing characters}\label{comparing-characters}}

Simultaneously to the setting above, we now want to compare the development of several characters for a single word field. This unfortunately requires some reshuffling of the data, using the function \texttt{reshape} (from the \texttt{stats} package).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dsl <-}\StringTok{ }\KeywordTok{dictionaryStatistics}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{, }
                            \DataTypeTok{fieldnames=}\KeywordTok{c}\NormalTok{(}\StringTok{"Liebe"}\NormalTok{),}
                            \DataTypeTok{normalizeByFigure=}\OtherTok{TRUE}\NormalTok{,}
                            \DataTypeTok{segment=}\StringTok{"Act"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{,}
         \DataTypeTok{n =} \DecValTok{6}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{format}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}

\NormalTok{dsl <-}\StringTok{ }\KeywordTok{reshape}\NormalTok{(dsl, }\DataTypeTok{direction =} \StringTok{"wide"}\NormalTok{,  }\CommentTok{# the table becomes wider}
               \DataTypeTok{timevar =} \StringTok{"Number.Act"}\NormalTok{,   }\CommentTok{# the column that specifies multiple readings}
               \DataTypeTok{times =} \StringTok{"Liebe"}\NormalTok{,          }\CommentTok{# the number to distribute}
               \DataTypeTok{idvar=}\KeywordTok{c}\NormalTok{(}\StringTok{"corpus"}\NormalTok{,}\StringTok{"drama"}\NormalTok{,}\StringTok{"character"}\NormalTok{)   }\CommentTok{# what identifies a character}
\NormalTok{)}

\NormalTok{mat <-}\StringTok{ }\KeywordTok{as.matrix.data.frame}\NormalTok{(dsl[,}\DecValTok{4}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(dsl)])}
\KeywordTok{rownames}\NormalTok{(mat) <-}\StringTok{ }\NormalTok{dsl}\OperatorTok{$}\NormalTok{character}
\NormalTok{mat <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(mat,}\DecValTok{1}\NormalTok{,cumsum)}

\KeywordTok{matplot}\NormalTok{(mat, }\DataTypeTok{type=}\StringTok{"l"}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(mat), }\DataTypeTok{col=}\StringTok{"black"}\NormalTok{, }\DataTypeTok{main=}\StringTok{"Liebe"}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\DataTypeTok{x=}\StringTok{"topleft"}\NormalTok{, }\DataTypeTok{legend=}\KeywordTok{colnames}\NormalTok{(mat), }\DataTypeTok{lty=}\DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(mat))}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-59-1.pdf}

\hypertarget{corpus-analysis-1}{%
\section{Corpus Analysis}\label{corpus-analysis-1}}

Finally, we will do word field analysis with a small corpus. The following snippet creates a vector with ids for plays from the \emph{Sturm und Drang} period. Providing this vector as an argument for the \texttt{loadDrama()} function loads them all as a single \texttt{QDDrama} object. To reproduce this, you will need to install the quadrama corpus first, which can be done by executing \texttt{installData("qd")}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sturm_und_drang.ids <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"qd:11f81.0"}\NormalTok{, }\StringTok{"qd:11g1d.0"}\NormalTok{, }\StringTok{"qd:11g9w.0"}\NormalTok{, }
                         \StringTok{"qd:11hdv.0"}\NormalTok{, }\StringTok{"qd:nds0.0"}\NormalTok{, }\StringTok{"qd:r12k.0"}\NormalTok{, }
                         \StringTok{"qd:r12v.0"}\NormalTok{, }\StringTok{"qd:r134.0"}\NormalTok{,  }\StringTok{"qd:r13g.0"}\NormalTok{, }
                         \StringTok{"qd:rfxf.0"}\NormalTok{,  }\StringTok{"qd:rhtz.0"}\NormalTok{, }\StringTok{"qd:rhzq.0"}\NormalTok{, }
                         \StringTok{"qd:rj22.0"}\NormalTok{, }\StringTok{"qd:tx4z.0"}\NormalTok{, }\StringTok{"qd:tz39.0"}\NormalTok{, }
                         \StringTok{"qd:tzgk.0"}\NormalTok{, }\StringTok{"qd:v0fv.0"}\NormalTok{, }\StringTok{"qd:wznj.0"}\NormalTok{, }
                         \StringTok{"qd:tx4z.0"}\NormalTok{, }\StringTok{"qd:rfxf.0"}\NormalTok{)}

\NormalTok{sturm_und_drang.plays <-}\StringTok{ }\KeywordTok{loadDrama}\NormalTok{(sturm_und_drang.ids)}
\end{Highlighting}
\end{Shaded}

The resulting table is reproduced here in readable formatting:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(sturm_und_drang.plays}\OperatorTok{$}\NormalTok{meta)}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{l|l|l|l|l|l|l|l|r|r|r|l}
\hline
corpus & drama & documentTitle & language & Name & Pnd & Translator.Name & Translator.Pnd & Date.Written & Date.Printed & Date.Premiere & Date.Translation\\
\hline
qd & 11f81.0 & Clavigo & de & Goethe, Johann Wolfgang & 118540238 & NA & NA & 1774 & 1774 & 1774 & NA\\
\hline
qd & 11g1d.0 & Götz von Berlichingen mit der eisernen Hand & de & Goethe, Johann Wolfgang & 118540238 & NA & NA & NA & 1773 & NA & NA\\
\hline
qd & 11g9w.0 & Egmont & de & Goethe, Johann Wolfgang & 118540238 & NA & NA & 1787 & 1788 & 1791 & NA\\
\hline
qd & 11hdv.0 & Stella & de & Goethe, Johann Wolfgang & 118540238 & NA & NA & 1776 & 1776 & 1776 & NA\\
\hline
qd & nds0.0 & Ugolino & de & Gerstenberg, Heinrich Wilhelm von & 118690949 & NA & NA & NA & 1768 & 1769 & NA\\
\hline
qd & r12k.0 & Sturm und Drang & de & Klinger, Friedrich Maximilian & 118563319 & NA & NA & 1776 & NA & NA & NA\\
\hline
qd & r12v.0 & Die Zwillinge & de & Klinger, Friedrich Maximilian & 118563319 & NA & NA & NA & 1776 & 1776 & NA\\
\hline
qd & r134.0 & Die neue Arria & de & Klinger, Friedrich Maximilian & 118563319 & NA & NA & NA & NA & NA & NA\\
\hline
qd & r13g.0 & Simsone Grisaldo & de & Klinger, Friedrich Maximilian & 118563319 & NA & NA & NA & NA & NA & NA\\
\hline
qd & rfxf.0 & Julius von Tarent & de & Leisewitz, Johann Anton & 118571370 & NA & NA & NA & NA & NA & NA\\
\hline
qd & rhtz.0 & Die Soldaten & de & Lenz, Jakob Michael Reinhold & 118571656 & NA & NA & 1775 & 1776 & 1863 & NA\\
\hline
qd & rhzq.0 & Der Hofmeister oder Vorteile der Privaterziehung & de & Lenz, Jakob Michael Reinhold & 118571656 & NA & NA & 1772 & 1774 & NA & NA\\
\hline
qd & rj22.0 & Der neue Menoza & de & Lenz, Jakob Michael Reinhold & 118571656 & NA & NA & NA & NA & NA & NA\\
\hline
qd & tx4z.0 & Don Carlos, Infant von Spanien & de & Schiller, Friedrich & 118607626 & NA & NA & 1787 & 1787 & 1787 & NA\\
\hline
qd & tz39.0 & Kabale und Liebe & de & Schiller, Friedrich & 118607626 & NA & NA & 1783 & NA & NA & NA\\
\hline
qd & tzgk.0 & Die Verschwörung des Fiesco zu Genua & de & Schiller, Friedrich & 118607626 & NA & NA & 1782 & NA & NA & NA\\
\hline
qd & v0fv.0 & Die Räuber & de & Schiller, Friedrich & 118607626 & NA & NA & 1780 & 1781 & 1882 & NA\\
\hline
qd & wznj.0 & Die Kindermörderin & de & Wagner, Heinrich Leopold & 11862833X & NA & NA & 1776 & NA & 1777 & NA\\
\hline
\end{tabular}

For the sake of demo, we will use the \texttt{base\_dictionary} that is included in the R package. It contains entries for the fields Familie, Krieg, Ratio, Liebe, Religion. Typing \texttt{base\_dictionary} in the R console shows all words in all five fields. For loading other dictionaries, \textbf{see above}.

Counting word frequencies on a corpus works exactly as on a single text.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dictionaryStatistics}\NormalTok{(sturm_und_drang.plays, }
                     \DataTypeTok{fieldnames=}\KeywordTok{names}\NormalTok{(base_dictionary), }
                     \DataTypeTok{byFigure =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    corpus   drama Familie Krieg Ratio Liebe Religion
## 1      qd 11f81.0     168    47   100   159       48
## 2      qd 11g1d.0     158   183   107   188      142
## 3      qd 11g9w.0     137   179   120   173       80
## 4      qd 11hdv.0     119    22    40   207       77
## 5      qd  nds0.0     284    47    50   124      103
## 6      qd  r12k.0     216    84    67   210       56
## 7      qd  r12v.0     349   141    47   191       64
## 8      qd  r134.0     136    88    93   384       75
## 9      qd  r13g.0      87   156   107   357       76
## 10     qd  rfxf.0     504   142   220   428      160
## 11     qd  rhtz.0     182    53   100    63       44
## 12     qd  rhzq.0     357    76   123    98      114
## 13     qd  rj22.0     217    46    93   114      102
## 14     qd  tx4z.0     606   378   552   746      420
## 15     qd  tz39.0     441   109   178   263      197
## 16     qd  tzgk.0     213   220   151   195      111
## 17     qd  v0fv.0     394   191   222   298      243
## 18     qd  wznj.0     246    35   129    78       95
\end{verbatim}

In order to visualize this in a time line, we need to merge this table with the meta data table. This can be done easily with the \texttt{merge()} function. This function is quite handy in our use cases, as it can merge tables based on values in the table. In our case, we mostly want to merge tables that both have a \texttt{corpus} and \texttt{drama} column. If the two tables have columns with the same name, this is done automatically. Otherwise, one can specify the columns using the arguments \texttt{by}, \texttt{by.x} and/or \texttt{by.y}.

As the data contains three different types of date (written, printed, premiere), and not all plays have all dates, we create an artificial reference date by taking the earliest date possible. This is done using the \texttt{apply} function in the code below, and by taking the minimum value in each row.

After that, the table is ordered by this reference date, and the plotting itself can be done with regular \texttt{plot()} function provided by R.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# count the words (as before)}
\NormalTok{dstat <-}\StringTok{ }\KeywordTok{dictionaryStatistics}\NormalTok{(sturm_und_drang.plays, }
                     \DataTypeTok{fieldnames=}\KeywordTok{names}\NormalTok{(base_dictionary), }
                     \DataTypeTok{byFigure =} \OtherTok{FALSE}\NormalTok{, }
                     \DataTypeTok{normalizeByFigure =} \OtherTok{TRUE}\NormalTok{)}

\CommentTok{# merge them with the meta object}
\NormalTok{dstat <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(dstat, sturm_und_drang.plays}\OperatorTok{$}\NormalTok{meta)}

\CommentTok{# for each play, take the earliest date available}
\CommentTok{# (not all plays have all kinds of date)}
\NormalTok{dstat}\OperatorTok{$}\NormalTok{Date.Ref <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(dstat[,}\KeywordTok{c}\NormalTok{(}\StringTok{"Date.Printed"}\NormalTok{, }\StringTok{"Date.Written"}\NormalTok{, }\StringTok{"Date.Premiere"}\NormalTok{)], }
                        \DecValTok{1}\NormalTok{, min, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in FUN(newX[, i], ...): kein nicht-fehlendes Argument für min; gebe
## Inf zurück

## Warning in FUN(newX[, i], ...): kein nicht-fehlendes Argument für min; gebe
## Inf zurück

## Warning in FUN(newX[, i], ...): kein nicht-fehlendes Argument für min; gebe
## Inf zurück

## Warning in FUN(newX[, i], ...): kein nicht-fehlendes Argument für min; gebe
## Inf zurück
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# order them by this reference date}
\NormalTok{dstat <-}\StringTok{ }\NormalTok{dstat[}\KeywordTok{order}\NormalTok{(dstat}\OperatorTok{$}\NormalTok{Date.Ref),]}

\CommentTok{# plot them}
\KeywordTok{plot}\NormalTok{(Liebe }\OperatorTok{~}\StringTok{ }\NormalTok{Date.Ref,  }\CommentTok{# y ~ x}
     \DataTypeTok{data =}\NormalTok{ dstat[dstat}\OperatorTok{$}\NormalTok{Date.Ref}\OperatorTok{!=}\OtherTok{Inf}\NormalTok{,],  }\CommentTok{# the data set, filtering Inf values}
     \DataTypeTok{pch =} \DecValTok{4}\NormalTok{,           }\CommentTok{# we print a cross (see ?points for other options)}
     \DataTypeTok{xlab=}\StringTok{"Year"}        \CommentTok{# label of the x axis}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-63-1.pdf}

The resulting plot shows the percentage of \emph{love}-words in each play, organized by reference date. Thus, in 1776, a very ``lovely'' play has been published, achieving over 1.8 percent of love words (it's \emph{Stella} by Goethe). The identification of plays in this plot can be simplified if we plot not only crosses/points, but some kind of identifier. In the plot below, we use the textgrid id of the play (which we also use in QuaDramA, because it's relatively short and still memorable).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# it makes use of the text() function much easier if we have}
\CommentTok{# a new variable for this filtered data set}
\NormalTok{dstat.filtered <-}\StringTok{ }\NormalTok{dstat[dstat}\OperatorTok{$}\NormalTok{Date.Ref}\OperatorTok{!=}\OtherTok{Inf}\NormalTok{,]}

\KeywordTok{plot}\NormalTok{(Liebe }\OperatorTok{~}\StringTok{ }\NormalTok{Date.Ref,  }\CommentTok{# y ~ x}
     \DataTypeTok{data =}\NormalTok{ dstat.filtered, }\CommentTok{# the data set}
     \DataTypeTok{pch =} \DecValTok{4}\NormalTok{,           }\CommentTok{# we print a cross (see ?points for other options)}
     \DataTypeTok{xlab=}\StringTok{"Year"}        \CommentTok{# label of the x axis}
\NormalTok{)}

\KeywordTok{text}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ dstat.filtered}\OperatorTok{$}\NormalTok{Date.Ref}\OperatorTok{+}\DecValTok{1}\NormalTok{, }
     \DataTypeTok{y =}\NormalTok{ dstat.filtered}\OperatorTok{$}\NormalTok{Liebe,}
     \DataTypeTok{labels=}\NormalTok{dstat.filtered}\OperatorTok{$}\NormalTok{drama,}
     \DataTypeTok{cex=}\FloatTok{0.7}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-64-1.pdf}

\hypertarget{advanced-text-analysis}{%
\chapter{Advanced Text Analysis}\label{advanced-text-analysis}}

\hypertarget{when-are-characters-mentioned}{%
\section{When are characters mentioned?}\label{when-are-characters-mentioned}}

When characters are speaking on stage, they are actively present. But they can also be passively present, if other characters refer to them. Both levels of presence can be extracted with the \texttt{presence()} function:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Load Emilia Galotti}
\KeywordTok{data}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}

\NormalTok{pres <-}\StringTok{ }\KeywordTok{presence}\NormalTok{(rksp}\FloatTok{.0}\NormalTok{)}
\NormalTok{pres}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    corpus  drama        character scenes actives passives    presence
## 1    test rksp.0           angelo     43       2        1  0.02325581
## 2    test rksp.0          appiani     43       5       14 -0.20930233
## 3    test rksp.0         battista     43       4        6 -0.04651163
## 4    test rksp.0     camillo_rota     43       1        2 -0.02325581
## 5    test rksp.0  claudia_galotti     43      13       14 -0.02325581
## 6    test rksp.0            conti     43       1        3 -0.04651163
## 7    test rksp.0 der_kammerdiener     43       1        2 -0.02325581
## 8    test rksp.0        der_prinz     43      14       21 -0.16279070
## 9    test rksp.0           emilia     43       7       21 -0.32558140
## 10   test rksp.0        marinelli     43      19       21 -0.04651163
## 11   test rksp.0          odoardo     43      12       11  0.02325581
## 12   test rksp.0           orsina     43       6       10 -0.09302326
## 13   test rksp.0            pirro     43       4        5 -0.02325581
\end{verbatim}

As we can see, each character has a few numbers associated: The column \texttt{actives} shows the number of scenes in which the character is actively present. This is equivalent to the information in the configuration matrix. The column \texttt{passives} shows the number of scenes in which a character is mentioned. By default, this excludes the scenes in which they are present themselves (this behaviour can be changed by adding the parameter \texttt{passiveOnlyWhenNotActive\ =\ TRUE} to the call of the \texttt{presence} function).

A simple visualisation that shows the characters active and passive presence in one plot can be generated like this: The first line (\texttt{plot()}) is responsible for the plotting of the symbols, the second line (\texttt{text()}) adds the character names or ids numbers.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\DataTypeTok{x=}\NormalTok{pres}\OperatorTok{$}\NormalTok{active}\OperatorTok{/}\NormalTok{pres}\OperatorTok{$}\NormalTok{scenes, }
     \DataTypeTok{y=}\NormalTok{pres}\OperatorTok{$}\NormalTok{passive}\OperatorTok{/}\NormalTok{pres}\OperatorTok{$}\NormalTok{scenes, }
     \DataTypeTok{xlim=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{), }
     \DataTypeTok{ylim=}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{), }
     \DataTypeTok{xlab=}\StringTok{"Active"}\NormalTok{, }
     \DataTypeTok{ylab=}\StringTok{"Passive"}\NormalTok{,}
     \DataTypeTok{main=}\StringTok{"Character Presence"}\NormalTok{)}
\KeywordTok{text}\NormalTok{(}\DataTypeTok{x=}\NormalTok{pres}\OperatorTok{$}\NormalTok{actives}\OperatorTok{/}\NormalTok{pres}\OperatorTok{$}\NormalTok{scenes, }
     \DataTypeTok{y=}\NormalTok{pres}\OperatorTok{$}\NormalTok{passives}\OperatorTok{/}\NormalTok{pres}\OperatorTok{$}\NormalTok{scenes, }
     \DataTypeTok{labels=}\KeywordTok{substr}\NormalTok{(pres}\OperatorTok{$}\NormalTok{character,}\DecValTok{0}\NormalTok{,}\DecValTok{20}\NormalTok{), }
     \DataTypeTok{pos=}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-66-1.pdf}

\hypertarget{resterampe}{%
\chapter{Resterampe}\label{resterampe}}

\hypertarget{character-meta-data}{%
\subsection{Character meta data}\label{character-meta-data}}

We will now combine this information with additional meta data about characters, i.e., gender.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Proportion of male / female characters}
\KeywordTok{barplot}\NormalTok{(}\KeywordTok{table}\NormalTok{(text}\OperatorTok{$}\NormalTok{characters}\OperatorTok{$}\NormalTok{Gender),}\DataTypeTok{col=}\NormalTok{qd.colors)}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-67-1.pdf}

\hypertarget{character-groups}{%
\subsection{Character groups}\label{character-groups}}

Next, we want to make the same analysis not for individual characters, but for character groups, based on categories such as gender.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ustat <-}\StringTok{ }\KeywordTok{utteranceStatistics}\NormalTok{(rjmw}\FloatTok{.0}\NormalTok{, }
                             \DataTypeTok{normalizeByDramaLength =} \OtherTok{FALSE} \CommentTok{# use absolute values}
\NormalTok{                            )}

\NormalTok{characterdata <-}\StringTok{ }\NormalTok{rjmw}\FloatTok{.0}\OperatorTok{$}\NormalTok{characters}

\NormalTok{ustat <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(ustat, characterdata, }
               \DataTypeTok{by.x =} \KeywordTok{c}\NormalTok{(}\StringTok{"corpus"}\NormalTok{,}\StringTok{"drama"}\NormalTok{, }\StringTok{"character"}\NormalTok{),}
               \DataTypeTok{by.y =} \KeywordTok{c}\NormalTok{(}\StringTok{"corpus"}\NormalTok{,}\StringTok{"drama"}\NormalTok{, }\StringTok{"figure_id"}\NormalTok{))}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{boxplot}\NormalTok{(utteranceLength }\OperatorTok{~}\StringTok{ }\NormalTok{Gender, }\CommentTok{# what do we want to correlate }
        \DataTypeTok{data=}\NormalTok{ustat, }
        \DataTypeTok{las =} \DecValTok{1} \CommentTok{# rotate axis labels}
\NormalTok{      )}
\end{Highlighting}
\end{Shaded}

\includegraphics{DramaAnalysis_files/figure-latex/unnamed-chunk-68-1.pdf}

According to this picture, female characters speak slightly longer utterances in this play.

\bibliography{bibliography.bib}


\end{document}
